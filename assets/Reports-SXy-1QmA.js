import{u as y,j as e}from"./vendor-query-BBSsXiBS.js";import{u as F,a as A}from"./vendor-react-Cua_SOQ2.js";import{s as u}from"./index-De75nt2H.js";import{S as q,A as D,H,C as E,D as T}from"./AppSidebar-BMrVA_Jp.js";import{T as M}from"./TopBar-ioa75gCp.js";import{C as n,a as c,b as i,c as x}from"./card-nJjNL--Z.js";import{T as N,a as f,b as d,c as a,d as w,e as r}from"./table-D-R88hVk.js";import{T as k,a as K,b,c as _}from"./tabs-BX6TOnl4.js";import"./vendor-ui-Dpa_eFEd.js";import"./vendor-supabase-By2EX_dj.js";import"./useAuthenticatedUser-DxFjEeTf.js";import"./scroll-area-DovF1kS9.js";const te=()=>{const v=F();A.useEffect(()=>{(async()=>{const{data:{session:t}}=await u.auth.getSession();t||v("/auth")})()},[v]);const{data:S}=y({queryKey:["rentRoll"],queryFn:async()=>{const{data:s,error:t}=await u.from("units").select(`
          id,
          unit_number,
          monthly_rent,
          status,
          property:properties(name, address),
          tenant_units(
            tenant:profiles(first_name, last_name, email),
            lease_start_date,
            lease_end_date,
            status
          )
        `).order("unit_number");if(t)throw t;return s}}),{data:g}=y({queryKey:["incomeReport"],queryFn:async()=>{const{data:s,error:t}=await u.from("rent_payments").select(`
          id,
          amount,
          status,
          payment_date,
          payment_method,
          unit:units(
            unit_number,
            property:properties(name)
          ),
          tenant:profiles(first_name, last_name)
        `).order("payment_date",{ascending:!1});if(t)throw t;return s}}),{data:o}=y({queryKey:["propertySummary"],queryFn:async()=>{const{data:s,error:t}=await u.from("properties").select(`
          id,
          name,
          address,
          units(id, monthly_rent, status)
        `);if(t)throw t;return s?.map(m=>{const h=m.units||[],j=h.length,R=h.filter(l=>l.status==="occupied").length,L=h.reduce((l,p)=>l+(parseFloat(p.monthly_rent)||0),0),P=h.filter(l=>l.status==="occupied").reduce((l,p)=>l+(parseFloat(p.monthly_rent)||0),0);return{...m,totalUnits:j,occupiedUnits:R,vacancyRate:j>0?((j-R)/j*100).toFixed(1):0,potentialIncome:L,actualIncome:P}})}}),I=o?.reduce((s,t)=>s+t.potentialIncome,0)||0,C=o?.reduce((s,t)=>s+t.actualIncome,0)||0,U=o?.reduce((s,t)=>s+t.totalUnits,0)||0,$=o?.reduce((s,t)=>s+t.occupiedUnits,0)||0;return e.jsx(q,{children:e.jsxs("div",{className:"flex min-h-screen w-full bg-background",children:[e.jsx(D,{}),e.jsx("main",{className:"flex-1 p-4 sm:p-8",children:e.jsxs("div",{className:"flex flex-col gap-8",children:[e.jsx(M,{title:"Reports",subtitle:"View property and financial reports"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 sm:gap-4",children:[e.jsxs(n,{className:"glass-card",children:[e.jsxs(c,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(i,{className:"text-sm font-medium text-gray-400",children:"Total Properties"}),e.jsx(H,{className:"h-4 w-4 text-gray-400"})]}),e.jsx(x,{children:e.jsx("div",{className:"text-2xl font-bold text-white",children:o?.length||0})})]}),e.jsxs(n,{className:"glass-card",children:[e.jsxs(c,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(i,{className:"text-sm font-medium text-gray-400",children:"Total Units"}),e.jsx(E,{className:"h-4 w-4 text-gray-400"})]}),e.jsxs(x,{children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:U}),e.jsxs("p",{className:"text-xs text-gray-400",children:[$," occupied"]})]})]}),e.jsxs(n,{className:"glass-card",children:[e.jsxs(c,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(i,{className:"text-sm font-medium text-gray-400",children:"Potential Monthly Income"}),e.jsx(T,{className:"h-4 w-4 text-gray-400"})]}),e.jsx(x,{children:e.jsxs("div",{className:"text-2xl font-bold text-white",children:["$",I.toLocaleString()]})})]}),e.jsxs(n,{className:"glass-card",children:[e.jsxs(c,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(i,{className:"text-sm font-medium text-gray-400",children:"Current Monthly Income"}),e.jsx(T,{className:"h-4 w-4 text-green-400"})]}),e.jsx(x,{children:e.jsxs("div",{className:"text-2xl font-bold text-green-400",children:["$",C.toLocaleString()]})})]})]}),e.jsxs(k,{defaultValue:"rent-roll",className:"w-full",children:[e.jsxs(K,{className:"bg-white/[0.04] border-white/[0.08]",children:[e.jsx(b,{value:"rent-roll",children:"Rent Roll"}),e.jsx(b,{value:"income",children:"Income Report"}),e.jsx(b,{value:"property",children:"Property Summary"})]}),e.jsx(_,{value:"rent-roll",children:e.jsxs(n,{className:"glass-card",children:[e.jsx(c,{children:e.jsx(i,{className:"text-white",children:"Rent Roll"})}),e.jsx(x,{className:"overflow-x-auto",children:e.jsxs(N,{className:"min-w-[600px]",children:[e.jsx(f,{children:e.jsxs(d,{children:[e.jsx(a,{className:"text-gray-300",children:"Property"}),e.jsx(a,{className:"text-gray-300",children:"Unit"}),e.jsx(a,{className:"text-gray-300",children:"Tenant"}),e.jsx(a,{className:"text-gray-300",children:"Lease Dates"}),e.jsx(a,{className:"text-gray-300",children:"Monthly Rent"}),e.jsx(a,{className:"text-gray-300",children:"Status"})]})}),e.jsx(w,{children:S?.map(s=>{const t=s.tenant_units?.find(m=>m.status==="active");return e.jsxs(d,{children:[e.jsx(r,{className:"text-white",children:s.property?.name}),e.jsx(r,{className:"text-gray-300",children:s.unit_number}),e.jsx(r,{className:"text-gray-300",children:t?.tenant?`${t.tenant.first_name} ${t.tenant.last_name}`:"-"}),e.jsx(r,{className:"text-gray-300",children:t?`${t.lease_start_date} - ${t.lease_end_date}`:"-"}),e.jsxs(r,{className:"text-white",children:["$",parseFloat(s.monthly_rent).toLocaleString()]}),e.jsx(r,{children:e.jsx("span",{className:`px-2 py-1 rounded text-xs ${s.status==="occupied"?"bg-green-500/20 text-green-400":"bg-yellow-500/20 text-yellow-400"}`,children:s.status})})]},s.id)})})]})})]})}),e.jsx(_,{value:"income",children:e.jsxs(n,{className:"glass-card",children:[e.jsx(c,{children:e.jsx(i,{className:"text-white",children:"Income Report"})}),e.jsx(x,{className:"overflow-x-auto",children:g&&g.length>0?e.jsxs(N,{className:"min-w-[600px]",children:[e.jsx(f,{children:e.jsxs(d,{children:[e.jsx(a,{className:"text-gray-300",children:"Date"}),e.jsx(a,{className:"text-gray-300",children:"Property/Unit"}),e.jsx(a,{className:"text-gray-300",children:"Tenant"}),e.jsx(a,{className:"text-gray-300",children:"Amount"}),e.jsx(a,{className:"text-gray-300",children:"Method"}),e.jsx(a,{className:"text-gray-300",children:"Status"})]})}),e.jsx(w,{children:g.map(s=>e.jsxs(d,{children:[e.jsx(r,{className:"text-gray-300",children:new Date(s.payment_date).toLocaleDateString()}),e.jsxs(r,{className:"text-white",children:[s.unit?.property?.name," - Unit ",s.unit?.unit_number]}),e.jsxs(r,{className:"text-gray-300",children:[s.tenant?.first_name," ",s.tenant?.last_name]}),e.jsxs(r,{className:"text-white",children:["$",parseFloat(s.amount).toLocaleString()]}),e.jsx(r,{className:"text-gray-300",children:s.payment_method||"-"}),e.jsx(r,{children:e.jsx("span",{className:`px-2 py-1 rounded text-xs ${s.status==="completed"?"bg-green-500/20 text-green-400":s.status==="pending"?"bg-yellow-500/20 text-yellow-400":"bg-red-500/20 text-red-400"}`,children:s.status})})]},s.id))})]}):e.jsx("p",{className:"text-gray-400 text-center py-8",children:"No payment history yet"})})]})}),e.jsx(_,{value:"property",children:e.jsxs(n,{className:"glass-card",children:[e.jsx(c,{children:e.jsx(i,{className:"text-white",children:"Property Summary"})}),e.jsx(x,{className:"overflow-x-auto",children:e.jsxs(N,{className:"min-w-[700px]",children:[e.jsx(f,{children:e.jsxs(d,{children:[e.jsx(a,{className:"text-gray-300",children:"Property"}),e.jsx(a,{className:"text-gray-300",children:"Address"}),e.jsx(a,{className:"text-gray-300",children:"Units"}),e.jsx(a,{className:"text-gray-300",children:"Occupied"}),e.jsx(a,{className:"text-gray-300",children:"Vacancy Rate"}),e.jsx(a,{className:"text-gray-300",children:"Potential Income"}),e.jsx(a,{className:"text-gray-300",children:"Current Income"})]})}),e.jsx(w,{children:o?.map(s=>e.jsxs(d,{children:[e.jsx(r,{className:"text-white font-medium",children:s.name}),e.jsx(r,{className:"text-gray-300",children:s.address}),e.jsx(r,{className:"text-gray-300",children:s.totalUnits}),e.jsx(r,{className:"text-gray-300",children:s.occupiedUnits}),e.jsx(r,{children:e.jsxs("span",{className:`${parseFloat(s.vacancyRate)>20?"text-red-400":"text-green-400"}`,children:[s.vacancyRate,"%"]})}),e.jsxs(r,{className:"text-gray-300",children:["$",s.potentialIncome.toLocaleString()]}),e.jsxs(r,{className:"text-green-400",children:["$",s.actualIncome.toLocaleString()]})]},s.id))})]})})]})})]})]})})]})})};export{te as default};
