import{u as ee,b as se,c as oe,j as a}from"./vendor-query-BBSsXiBS.js";import{a as v,u as kt}from"./vendor-react-Cua_SOQ2.js";import{c as ie,s as z,M as ot,h as E,B as it,o as Dt,b as G,X as Lt,L as ve,S as Me,d as ze,e as ke,f as De,g as Le,I as Pt,A as Et}from"./index-De75nt2H.js";import{u as A,S as Y}from"./useAuthenticatedUser-DxFjEeTf.js";import{A as te,b as he,a as ne}from"./avatar-BzXIJ7c5.js";import{B as Rt}from"./badge-COPlmVyV.js";import{S as It}from"./scroll-area-DovF1kS9.js";import{t as L,c as Tt,g as Pe,a as $t,e as Ft,n as Ee,o as ue,f as Z}from"./format-BJjq1L2l.js";import{e as Gt,d as At,i as lt,s as Ot}from"./subDays-D3ZmYt_g.js";import{T as qt}from"./textarea-BksRswRQ.js";import{L as ct}from"./loader-circle-CxRwcVV4.js";import{S as Ut}from"./send-BsAD5O5v.js";import{D as Ht,a as Wt,b as Vt,c as Xt,d as Bt,e as Kt}from"./dialog-CU0zoF6x.js";import{P as Yt}from"./plus-CuU8l0SB.js";import{C as Qt}from"./card-nJjNL--Z.js";import{D as Re,a as Ie,E as Te,b as $e,c as Fe}from"./dropdown-menu-ADG-5tNT.js";import"./vendor-ui-Dpa_eFEd.js";import"./vendor-supabase-By2EX_dj.js";import"./chevron-right-BxT_eo_W.js";import"./circle-C417sgD2.js";const Ge=ie("Archive",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]]);const Jt=ie("CheckCheck",[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]]);const Zt=ie("File",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]]);const en=ie("GripVertical",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]);const Ae=ie("Paperclip",[["path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48",key:"1u3ebp"}]]);function me(e,t){const n=L(e),r=L(t),s=n.getTime()-r.getTime();return s<0?-1:s>0?1:s}function je(e){return Tt(e,Date.now())}function tn(e){return t=>{const r=(e?Math[e]:Math.trunc)(t);return r===0?0:r}}function nn(e,t){return+L(e)-+L(t)}function rn(e){const t=L(e);return t.setHours(23,59,59,999),t}function an(e){const t=L(e);return+rn(t)==+Gt(t)}function sn(e,t){const n=L(e),r=L(t),s=me(n,r),o=Math.abs(At(n,r));let c;if(o<1)c=0;else{n.getMonth()===1&&n.getDate()>27&&n.setDate(30),n.setMonth(n.getMonth()-s*o);let i=me(n,r)===-s;an(L(e))&&o===1&&me(e,r)===1&&(i=!1),c=s*(o-Number(i))}return c===0?0:c}function on(e,t,n){const r=nn(e,t)/1e3;return tn(n?.roundingMethod)(r)}function ln(e,t,n){const r=$t(),s=n?.locale??r.locale??Ft,o=2520,c=me(e,t);if(isNaN(c))throw new RangeError("Invalid time value");const i=Object.assign({},n,{addSuffix:n?.addSuffix,comparison:c});let l,u;c>0?(l=L(t),u=L(e)):(l=L(e),u=L(t));const m=on(u,l),p=(Pe(u)-Pe(l))/1e3,x=Math.round((m-p)/60);let f;if(x<2)return n?.includeSeconds?m<5?s.formatDistance("lessThanXSeconds",5,i):m<10?s.formatDistance("lessThanXSeconds",10,i):m<20?s.formatDistance("lessThanXSeconds",20,i):m<40?s.formatDistance("halfAMinute",0,i):m<60?s.formatDistance("lessThanXMinutes",1,i):s.formatDistance("xMinutes",1,i):x===0?s.formatDistance("lessThanXMinutes",1,i):s.formatDistance("xMinutes",x,i);if(x<45)return s.formatDistance("xMinutes",x,i);if(x<90)return s.formatDistance("aboutXHours",1,i);if(x<Ee){const d=Math.round(x/60);return s.formatDistance("aboutXHours",d,i)}else{if(x<o)return s.formatDistance("xDays",1,i);if(x<ue){const d=Math.round(x/Ee);return s.formatDistance("xDays",d,i)}else if(x<ue*2)return f=Math.round(x/ue),s.formatDistance("aboutXMonths",f,i)}if(f=sn(u,l),f<12){const d=Math.round(x/ue);return s.formatDistance("xMonths",d,i)}else{const d=f%12,h=Math.trunc(f/12);return d<3?s.formatDistance("aboutXYears",h,i):d<9?s.formatDistance("overXYears",h,i):s.formatDistance("almostXYears",h+1,i)}}function cn(e,t){return ln(e,je(e),t)}function Oe(e){return lt(e,je(e))}function qe(e){return lt(e,Ot(je(e),1))}function un(){const{user:e}=A();return ee({queryKey:["conversations",e?.id],queryFn:async()=>{if(!e)return[];const{data:t,error:n}=await z.from("conversations").select(`
          *,
          property:properties(name, address),
          unit:units(unit_number),
          landlord:profiles!conversations_landlord_id_fkey(id, first_name, last_name, email, avatar_url),
          tenant:profiles!conversations_tenant_id_fkey(id, first_name, last_name, email, avatar_url)
        `).or(`landlord_id.eq.${e.id},tenant_id.eq.${e.id}`).eq("is_archived",!1).order("last_message_at",{ascending:!1,nullsFirst:!1});if(n)throw n;return(t||[]).map(r=>({...r,other_user:r.landlord_id===e.id?r.tenant:r.landlord}))},enabled:!!e})}function dn(e){const{user:t}=A();return ee({queryKey:["conversation",e],queryFn:async()=>{if(!e||!t)return null;const{data:n,error:r}=await z.from("conversations").select(`
          *,
          property:properties(name, address),
          unit:units(unit_number),
          landlord:profiles!conversations_landlord_id_fkey(id, first_name, last_name, email, avatar_url),
          tenant:profiles!conversations_tenant_id_fkey(id, first_name, last_name, email, avatar_url)
        `).eq("id",e).single();if(r)throw r;return{...n,other_user:n.landlord_id===t.id?n.tenant:n.landlord}},enabled:!!e&&!!t})}function fn(){const e=se(),{user:t}=A();return oe({mutationFn:async n=>{if(!t)throw new Error("Not authenticated");const{data:r}=await z.from("conversations").select("*").eq("landlord_id",t.id).eq("tenant_id",n.tenantId).eq("property_id",n.propertyId).maybeSingle();if(r)return r.is_archived&&await z.from("conversations").update({is_archived:!1}).eq("id",r.id),r;const{data:s,error:o}=await z.from("conversations").insert({landlord_id:t.id,tenant_id:n.tenantId,property_id:n.propertyId,unit_id:n.unitId||null,subject:n.subject||null}).select().single();if(o)throw o;return s},onSuccess:()=>{e.invalidateQueries({queryKey:["conversations"]})}})}function mn(){const e=se();return oe({mutationFn:async t=>{const{error:n}=await z.from("conversations").update({is_archived:!0}).eq("id",t);if(n)throw n},onSuccess:()=>{e.invalidateQueries({queryKey:["conversations"]})}})}function Ue({selectedId:e,onSelect:t}){const{data:n,isLoading:r}=un(),{user:s}=A();if(r)return a.jsx("div",{className:"space-y-3 p-4",children:[1,2,3].map(l=>a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(Y,{className:"h-10 w-10 rounded-full"}),a.jsxs("div",{className:"flex-1 space-y-2",children:[a.jsx(Y,{className:"h-4 w-3/4"}),a.jsx(Y,{className:"h-3 w-1/2"})]})]},l))});if(!n?.length)return a.jsxs("div",{className:"flex flex-col items-center justify-center p-8 text-center text-muted-foreground",children:[a.jsx(ot,{className:"h-12 w-12 mb-4 opacity-50"}),a.jsx("p",{className:"font-medium",children:"No conversations yet"}),a.jsx("p",{className:"text-sm",children:"Start a conversation with a tenant or landlord"})]});const o=l=>s?l.landlord_id===s.id?l.landlord_unread_count:l.tenant_unread_count:0,c=l=>{const u=l.other_user;return u?.first_name&&u?.last_name?`${u.first_name[0]}${u.last_name[0]}`.toUpperCase():u?.email?.[0]?.toUpperCase()||"?"},i=l=>{const u=l.other_user;return u?.first_name&&u?.last_name?`${u.first_name} ${u.last_name}`:u?.email||"Unknown"};return a.jsx(It,{className:"h-full",children:a.jsx("div",{className:"divide-y",children:n.map(l=>{const u=o(l),m=l.id===e;return a.jsxs("button",{onClick:()=>t(l),className:E("w-full flex items-start gap-3 p-4 text-left hover:bg-muted/50 transition-colors",m&&"bg-muted"),children:[a.jsxs(te,{className:"h-10 w-10 shrink-0",children:[a.jsx(he,{src:l.other_user?.avatar_url||void 0}),a.jsx(ne,{children:c(l)})]}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex items-center justify-between gap-2",children:[a.jsx("span",{className:E("font-medium truncate",u>0&&"font-semibold"),children:i(l)}),l.last_message_at&&a.jsx("span",{className:"text-xs text-muted-foreground shrink-0",children:cn(new Date(l.last_message_at),{addSuffix:!0})})]}),a.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[a.jsx(it,{className:"h-3 w-3 text-muted-foreground shrink-0"}),a.jsxs("span",{className:"text-xs text-muted-foreground truncate",children:[l.property?.name||"Property",l.unit?.unit_number&&` - Unit ${l.unit.unit_number}`]})]}),l.last_message_preview&&a.jsx("p",{className:E("text-sm text-muted-foreground truncate mt-1",u>0&&"text-foreground"),children:l.last_message_preview})]}),u>0&&a.jsx(Rt,{variant:"default",className:"shrink-0 rounded-full h-5 min-w-[1.25rem] flex items-center justify-center",children:u})]},l.id)})})})}function pn(e){A();const t=se(),n=ee({queryKey:["messages",e],queryFn:async()=>{if(!e)return[];const{data:r,error:s}=await z.from("messages").select(`
          *,
          sender:profiles!messages_sender_id_fkey(id, first_name, last_name, avatar_url)
        `).eq("conversation_id",e).order("created_at",{ascending:!0});if(s)throw s;return r},enabled:!!e});return v.useEffect(()=>{if(!e)return;const r=z.channel(`messages:${e}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:`conversation_id=eq.${e}`},async s=>{const{data:o}=await z.from("messages").select(`
              *,
              sender:profiles!messages_sender_id_fkey(id, first_name, last_name, avatar_url)
            `).eq("id",s.new.id).single();o&&t.setQueryData(["messages",e],(c=[])=>[...c,o])}).subscribe();return()=>{z.removeChannel(r)}},[e,t]),n}function hn(){const{user:e}=A(),t=se();return oe({mutationFn:async n=>{if(!e)throw new Error("Not authenticated");const{data:r,error:s}=await z.from("messages").insert({conversation_id:n.conversationId,sender_id:e.id,content:n.content,message_type:n.messageType||"text",attachment_url:n.attachmentUrl||null,attachment_name:n.attachmentName||null}).select(`
          *,
          sender:profiles!messages_sender_id_fkey(id, first_name, last_name, avatar_url)
        `).single();if(s)throw s;return r},onSuccess:n=>{t.setQueryData(["messages",n.conversation_id],(r=[])=>r.some(s=>s.id===n.id)?r:[...r,n]),t.invalidateQueries({queryKey:["conversations"]})}})}function xn(){const{user:e}=A(),t=se();return oe({mutationFn:async n=>{if(!e)throw new Error("Not authenticated");const{error:r}=await z.rpc("mark_messages_read",{p_conversation_id:n,p_user_id:e.id});if(r)throw r},onSuccess:(n,r)=>{t.invalidateQueries({queryKey:["messages",r]}),t.invalidateQueries({queryKey:["conversations"]}),t.invalidateQueries({queryKey:["unread-count"]})}})}function gn(){return oe({mutationFn:async e=>{const t=e.name.split(".").pop(),r=`message-attachments/${`${Date.now()}-${Math.random().toString(36).substring(7)}.${t}`}`,{error:s}=await z.storage.from("documents").upload(r,e);if(s)throw s;const{data:o}=z.storage.from("documents").getPublicUrl(r);return{url:o.publicUrl,name:e.name}}})}function He({conversationId:e}){const{data:t,isLoading:n}=pn(e),{mutate:r}=xn(),{user:s}=A(),o=v.useRef(null),c=v.useRef(!1);if(v.useEffect(()=>{o.current&&(o.current.scrollTop=o.current.scrollHeight)},[t]),v.useEffect(()=>{e&&!c.current&&t?.length&&(c.current=!0,r(e))},[e,t,r]),v.useEffect(()=>{c.current=!1},[e]),n)return a.jsx("div",{className:"flex-1 p-4 space-y-4",children:[1,2,3].map(p=>a.jsxs("div",{className:E("flex gap-3",p%2===0&&"justify-end"),children:[p%2!==0&&a.jsx(Y,{className:"h-8 w-8 rounded-full shrink-0"}),a.jsx(Y,{className:E("h-16 rounded-lg",p%2===0?"w-2/3":"w-1/2")}),p%2===0&&a.jsx(Y,{className:"h-8 w-8 rounded-full shrink-0"})]},p))});if(!t?.length)return a.jsx("div",{className:"flex-1 flex items-center justify-center text-muted-foreground",children:a.jsx("p",{children:"No messages yet. Start the conversation!"})});const i=p=>Oe(p)?Z(p,"h:mm a"):qe(p)?`Yesterday ${Z(p,"h:mm a")}`:Z(p,"MMM d, h:mm a"),l=p=>p.sender?.first_name&&p.sender?.last_name?`${p.sender.first_name[0]}${p.sender.last_name[0]}`.toUpperCase():"?",u=p=>p.attachment_url?p.message_type==="image"?a.jsx("a",{href:p.attachment_url,target:"_blank",rel:"noopener noreferrer",className:"block mt-2 max-w-xs",children:a.jsx("img",{src:p.attachment_url,alt:p.attachment_name||"Attachment",className:"rounded-lg max-h-48 object-cover"})}):a.jsxs("a",{href:p.attachment_url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 mt-2 p-2 bg-muted/50 rounded-lg hover:bg-muted transition-colors",children:[a.jsx(Zt,{className:"h-4 w-4"}),a.jsx("span",{className:"text-sm truncate",children:p.attachment_name||"Attachment"})]}):null;let m=null;return a.jsx("div",{ref:o,className:"flex-1 overflow-y-auto p-4 space-y-4",children:t.map(p=>{const x=p.sender_id===s?.id,f=new Date(p.created_at),d=Z(f,"yyyy-MM-dd"),h=d!==m;return m=d,a.jsxs("div",{children:[h&&a.jsx("div",{className:"flex items-center justify-center my-4",children:a.jsx("span",{className:"px-3 py-1 bg-muted rounded-full text-xs text-muted-foreground",children:Oe(f)?"Today":qe(f)?"Yesterday":Z(f,"MMMM d, yyyy")})}),a.jsxs("div",{className:E("flex gap-3",x&&"flex-row-reverse"),children:[!x&&a.jsxs(te,{className:"h-8 w-8 shrink-0",children:[a.jsx(he,{src:p.sender?.avatar_url||void 0}),a.jsx(ne,{className:"text-xs",children:l(p)})]}),a.jsxs("div",{className:E("max-w-[75%] space-y-1",x&&"items-end"),children:[a.jsxs("div",{className:E("px-4 py-2 rounded-2xl",x?"bg-primary text-primary-foreground rounded-br-md":"bg-muted rounded-bl-md"),children:[p.message_type==="system"?a.jsx("p",{className:"text-sm italic",children:p.content}):a.jsx("p",{className:"text-sm whitespace-pre-wrap break-words",children:p.content}),u(p)]}),a.jsxs("div",{className:E("flex items-center gap-1 px-1",x?"justify-end":"justify-start"),children:[a.jsx("span",{className:"text-xs text-muted-foreground",children:i(f)}),x&&(p.read_at?a.jsx(Jt,{className:"h-3 w-3 text-primary"}):a.jsx(Dt,{className:"h-3 w-3 text-muted-foreground"}))]})]}),x&&a.jsx(te,{className:"h-8 w-8 shrink-0",children:a.jsx(ne,{className:"text-xs bg-primary text-primary-foreground",children:"You"})})]})]},p.id)})})}function We({conversationId:e,disabled:t}){const[n,r]=v.useState(""),[s,o]=v.useState(null),[c,i]=v.useState(null),l=v.useRef(null),{mutate:u,isPending:m}=hn(),{mutateAsync:p,isPending:x}=gn(),f=m||x,d=async()=>{if(!n.trim()&&!s||f)return;let g,w,j="text";if(s)try{const M=await p(s);g=M.url,w=M.name,j=s.type.startsWith("image/")?"image":"file"}catch(M){console.error("Failed to upload attachment:",M);return}u({conversationId:e,content:n.trim()||(s?`Sent ${j==="image"?"an image":"a file"}`:""),messageType:j,attachmentUrl:g,attachmentName:w}),r(""),b()},h=g=>{g.key==="Enter"&&!g.shiftKey&&(g.preventDefault(),d())},y=g=>{const w=g.target.files?.[0];w&&(o(w),w.type.startsWith("image/")&&i(URL.createObjectURL(w))),l.current&&(l.current.value="")},b=()=>{o(null),c&&(URL.revokeObjectURL(c),i(null))};return a.jsxs("div",{className:"border-t p-4 bg-background",children:[s&&a.jsxs("div",{className:"mb-3 flex items-center gap-2 p-2 bg-muted rounded-lg",children:[c?a.jsx("img",{src:c,alt:"Preview",className:"h-12 w-12 rounded object-cover"}):a.jsx("div",{className:"h-12 w-12 rounded bg-muted-foreground/20 flex items-center justify-center",children:a.jsx(Ae,{className:"h-5 w-5"})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("p",{className:"text-sm font-medium truncate",children:s.name}),a.jsxs("p",{className:"text-xs text-muted-foreground",children:[(s.size/1024).toFixed(1)," KB"]})]}),a.jsx(G,{variant:"ghost",size:"icon",className:"h-8 w-8 shrink-0",onClick:b,children:a.jsx(Lt,{className:"h-4 w-4"})})]}),a.jsxs("div",{className:"flex items-end gap-2",children:[a.jsx("input",{ref:l,type:"file",accept:"image/*,.pdf,.doc,.docx,.xls,.xlsx,.txt",className:"hidden",onChange:y}),a.jsx(G,{variant:"ghost",size:"icon",className:"h-10 w-10 shrink-0",disabled:t||f,onClick:()=>l.current?.click(),children:a.jsx(Ae,{className:"h-5 w-5"})}),a.jsx("div",{className:"flex-1 relative",children:a.jsx(qt,{value:n,onChange:g=>r(g.target.value),onKeyDown:h,placeholder:"Type a message...",disabled:t||f,className:E("min-h-[2.5rem] max-h-32 resize-none pr-12","focus-visible:ring-1"),rows:1})}),a.jsx(G,{size:"icon",className:"h-10 w-10 shrink-0",disabled:t||f||!n.trim()&&!s,onClick:d,children:f?a.jsx(ct,{className:"h-5 w-5 animate-spin"}):a.jsx(Ut,{className:"h-5 w-5"})})]}),a.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Press Enter to send, Shift+Enter for new line"})]})}function Ve({onConversationCreated:e}){const[t,n]=v.useState(!1),[r,s]=v.useState(""),[o,c]=v.useState(""),[i,l]=v.useState(""),{user:u}=A(),{mutateAsync:m,isPending:p}=fn(),{data:x}=ee({queryKey:["my-properties",u?.id],queryFn:async()=>{if(!u)return[];const{data:h,error:y}=await z.from("properties").select("id, name, address").or(`created_by.eq.${u.id},property_manager_id.eq.${u.id}`);if(y)throw y;return h||[]},enabled:!!u&&t}),{data:f}=ee({queryKey:["property-tenants",r],queryFn:async()=>{if(!r)return[];const{data:h,error:y}=await z.from("tenant_units").select(`
          tenant_id,
          unit_id,
          units!inner(
            id,
            unit_number,
            property_id
          ),
          tenant:profiles!tenant_units_tenant_id_fkey(
            id,
            first_name,
            last_name,
            email
          )
        `).eq("units.property_id",r).eq("status","active");if(y)throw y;return h||[]},enabled:!!r}),d=async()=>{if(!r||!o)return;const h=f?.find(y=>y.tenant_id===o);try{const y=await m({tenantId:o,propertyId:r,unitId:h?.unit_id,subject:i||void 0});n(!1),s(""),c(""),l(""),e&&e(y.id)}catch(y){console.error("Failed to create conversation:",y)}};return a.jsxs(Ht,{open:t,onOpenChange:n,children:[a.jsx(Wt,{asChild:!0,children:a.jsxs(G,{children:[a.jsx(Yt,{className:"h-4 w-4 mr-2"}),"New Message"]})}),a.jsxs(Vt,{children:[a.jsxs(Xt,{children:[a.jsx(Bt,{children:"New Conversation"}),a.jsx(Kt,{children:"Start a conversation with a tenant"})]}),a.jsxs("div",{className:"space-y-4 mt-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(ve,{htmlFor:"property",children:"Property"}),a.jsxs(Me,{value:r,onValueChange:s,children:[a.jsx(ze,{id:"property",children:a.jsx(ke,{placeholder:"Select a property"})}),a.jsx(De,{children:x?.map(h=>a.jsx(Le,{value:h.id,children:h.name},h.id))})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(ve,{htmlFor:"tenant",children:"Tenant"}),a.jsxs(Me,{value:o,onValueChange:c,disabled:!r,children:[a.jsx(ze,{id:"tenant",children:a.jsx(ke,{placeholder:r?"Select a tenant":"Select a property first"})}),a.jsx(De,{children:f?.map(h=>a.jsxs(Le,{value:h.tenant_id,children:[h.tenant?.first_name," ",h.tenant?.last_name,h.units?.unit_number&&` (Unit ${h.units.unit_number})`]},h.tenant_id))})]}),r&&!f?.length&&a.jsx("p",{className:"text-sm text-muted-foreground",children:"No tenants found for this property"})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(ve,{htmlFor:"subject",children:"Subject (optional)"}),a.jsx(Pt,{id:"subject",value:i,onChange:h=>l(h.target.value),placeholder:"What's this about?"})]}),a.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[a.jsx(G,{variant:"outline",onClick:()=>n(!1),children:"Cancel"}),a.jsx(G,{onClick:d,disabled:!r||!o||p,children:p?a.jsxs(a.Fragment,{children:[a.jsx(ct,{className:"h-4 w-4 mr-2 animate-spin"}),"Creating..."]}):"Start Conversation"})]})]})]})]})}function S(e,t="Assertion error"){if(!e)throw Error(t)}function Q({group:e}){const{orientation:t,panels:n}=e;return n.reduce((r,s)=>(r+=t==="horizontal"?s.element.offsetWidth:s.element.offsetHeight,r),0)}function be(e,t){return t.sort(e==="horizontal"?yn:vn)}function yn(e,t){const n=e.element.offsetLeft-t.element.offsetLeft;return n!==0?n:e.element.offsetWidth-t.element.offsetWidth}function vn(e,t){const n=e.element.offsetTop-t.element.offsetTop;return n!==0?n:e.element.offsetHeight-t.element.offsetHeight}function ut(e){return e!==null&&typeof e=="object"&&"nodeType"in e&&e.nodeType===Node.ELEMENT_NODE}function dt(e,t){return{x:e.x>=t.left&&e.x<=t.right?0:Math.min(Math.abs(e.x-t.left),Math.abs(e.x-t.right)),y:e.y>=t.top&&e.y<=t.bottom?0:Math.min(Math.abs(e.y-t.top),Math.abs(e.y-t.bottom))}}function wn({orientation:e,rects:t,targetRect:n}){const r={x:n.x+n.width/2,y:n.y+n.height/2};let s,o=Number.MAX_VALUE;for(const c of t){const{x:i,y:l}=dt(r,c),u=e==="horizontal"?i:l;u<o&&(o=u,s=c)}return S(s,"No rect found"),s}function ft(e){const{element:t,orientation:n,panels:r,separators:s}=e,o=be(n,Array.from(t.children).filter(ut).map(m=>({element:m}))).map(({element:m})=>m),c=[];let i=!1,l,u=[];for(const m of o)if(m.hasAttribute("data-panel")){const p=r.find(x=>x.element===m);if(p){if(l){const x=l.element.getBoundingClientRect(),f=m.getBoundingClientRect();let d;if(i){const h=n==="horizontal"?new DOMRect(x.right,x.top,0,x.height):new DOMRect(x.left,x.bottom,x.width,0),y=n==="horizontal"?new DOMRect(f.left,f.top,0,f.height):new DOMRect(f.left,f.top,f.width,0);switch(u.length){case 0:{d=[h,y];break}case 1:{const b=u[0],g=wn({orientation:n,rects:[x,f],targetRect:b.element.getBoundingClientRect()});d=[b,g===x?y:h];break}default:{d=u;break}}}else u.length?d=u:d=[n==="horizontal"?new DOMRect(x.right,f.top,f.left-x.right,f.height):new DOMRect(f.left,x.bottom,f.width,f.top-x.bottom)];for(const h of d)c.push({group:e,groupSize:Q({group:e}),panels:[l,p],separator:"width"in h?void 0:h,rect:"width"in h?h:h.element.getBoundingClientRect()})}i=!1,l=p,u=[]}}else if(m.hasAttribute("data-separator")){const p=s.find(x=>x.element===m);p?u.push(p):(l=void 0,u=[])}else i=!0;return c}function bn(e,t){const n=getComputedStyle(e),r=parseFloat(n.fontSize);return t*r}function jn(e,t){const n=getComputedStyle(e.ownerDocument.body),r=parseFloat(n.fontSize);return t*r}function Sn(e){return e/100*window.innerHeight}function _n(e){return e/100*window.innerWidth}function Nn(e){switch(typeof e){case"number":return[e,"px"];case"string":{const t=parseFloat(e);return e.endsWith("%")?[t,"%"]:e.endsWith("px")?[t,"px"]:e.endsWith("rem")?[t,"rem"]:e.endsWith("em")?[t,"em"]:e.endsWith("vh")?[t,"vh"]:e.endsWith("vw")?[t,"vw"]:[t,"%"]}}}function de({groupSize:e,panelElement:t,styleProp:n}){let r;const[s,o]=Nn(n);switch(o){case"%":{r=s/100*e;break}case"px":{r=s;break}case"rem":{r=jn(t,s);break}case"em":{r=bn(t,s);break}case"vh":{r=Sn(s);break}case"vw":{r=_n(s);break}}return r}function I(e){return parseFloat(e.toFixed(3))}function Xe(e){const{panels:t}=e,n=Q({group:e});return n===0?t.map(r=>({collapsedSize:0,collapsible:r.panelConstraints.collapsible===!0,defaultSize:void 0,minSize:0,maxSize:100,panelId:r.id})):t.map(r=>{const{element:s,panelConstraints:o}=r;let c=0;if(o.collapsedSize){const m=de({groupSize:n,panelElement:s,styleProp:o.collapsedSize});c=I(m/n*100)}let i;if(o.defaultSize){const m=de({groupSize:n,panelElement:s,styleProp:o.defaultSize});i=I(m/n*100)}let l=0;if(o.minSize){const m=de({groupSize:n,panelElement:s,styleProp:o.minSize});l=I(m/n*100)}let u=100;if(o.maxSize){const m=de({groupSize:n,panelElement:s,styleProp:o.maxSize});u=I(m/n*100)}return{collapsedSize:c,collapsible:o.collapsible===!0,defaultSize:i,minSize:l,maxSize:u,panelId:r.id}})}class Cn{#e={};addListener(t,n){const r=this.#e[t];return r===void 0?this.#e[t]=[n]:r.includes(n)||r.push(n),()=>{this.removeListener(t,n)}}emit(t,n){const r=this.#e[t];if(r!==void 0)if(r.length===1)r[0].call(null,n);else{let s=!1,o=null;const c=Array.from(r);for(let i=0;i<c.length;i++){const l=c[i];try{l.call(null,n)}catch(u){o===null&&(s=!0,o=u)}}if(s)throw o}}removeAllListeners(){this.#e={}}removeListener(t,n){const r=this.#e[t];if(r!==void 0){const s=r.indexOf(n);s>=0&&r.splice(s,1)}}}function D(e,t,n=0){return Math.abs(I(e)-I(t))<=n}let P={cursorFlags:0,interactionState:{state:"inactive"},mountedGroups:new Map};const H=new Cn;function T(){return P}function R(e){const t=typeof e=="function"?e(P):e;if(P===t)return P;const n=P;return P={...P,...t},t.cursorFlags!==void 0&&H.emit("cursorFlagsChange",P.cursorFlags),t.interactionState!==void 0&&H.emit("interactionStateChange",P.interactionState),t.mountedGroups!==void 0&&(P.mountedGroups.forEach((r,s)=>{r.derivedPanelConstraints.forEach(o=>{if(o.collapsible){const{layout:c}=n.mountedGroups.get(s)??{};if(c){const i=D(o.collapsedSize,r.layout[o.panelId]),l=D(o.collapsedSize,c[o.panelId]);i&&!l&&(s.inMemoryLastExpandedPanelSizes[o.panelId]=c[o.panelId])}}})}),H.emit("mountedGroupsChange",P.mountedGroups)),P}function Mn(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!=t[n])return!1;return!0}function re(e,t){return D(e,t)?0:e>t?1:-1}function K({panelConstraints:e,size:t}){const{collapsedSize:n=0,collapsible:r,maxSize:s=100,minSize:o=0}=e;if(re(t,o)<0)if(r){const c=(n+o)/2;re(t,c)<0?t=n:t=o}else t=o;return t=Math.min(s,t),t=I(t),t}function ae({delta:e,initialLayout:t,panelConstraints:n,pivotIndices:r,prevLayout:s,trigger:o}){if(D(e,0))return t;const c=Object.values(t),i=Object.values(s),l=[...c],[u,m]=r;S(u!=null,"Invalid first pivot index"),S(m!=null,"Invalid second pivot index");let p=0;if(o==="keyboard"){{const d=e<0?m:u,h=n[d];S(h,`Panel constraints not found for index ${d}`);const{collapsedSize:y=0,collapsible:b,minSize:g=0}=h;if(b){const w=c[d];if(S(w!=null,`Previous layout not found for panel index ${d}`),D(w,y)){const j=g-w;re(j,Math.abs(e))>0&&(e=e<0?0-j:j)}}}{const d=e<0?u:m,h=n[d];S(h,`No panel constraints found for index ${d}`);const{collapsedSize:y=0,collapsible:b,minSize:g=0}=h;if(b){const w=c[d];if(S(w!=null,`Previous layout not found for panel index ${d}`),D(w,g)){const j=w-y;re(j,Math.abs(e))>0&&(e=e<0?0-j:j)}}}}{const d=e<0?1:-1;let h=e<0?m:u,y=0;for(;;){const g=c[h];S(g!=null,`Previous layout not found for panel index ${h}`);const w=K({panelConstraints:n[h],size:100})-g;if(y+=w,h+=d,h<0||h>=n.length)break}const b=Math.min(Math.abs(e),Math.abs(y));e=e<0?0-b:b}{let d=e<0?u:m;for(;d>=0&&d<n.length;){const h=Math.abs(e)-Math.abs(p),y=c[d];S(y!=null,`Previous layout not found for panel index ${d}`);const b=y-h,g=K({panelConstraints:n[d],size:b});if(!D(y,g)&&(p+=y-g,l[d]=g,p.toFixed(3).localeCompare(Math.abs(e).toFixed(3),void 0,{numeric:!0})>=0))break;e<0?d--:d++}}if(Mn(i,l))return s;{const d=e<0?m:u,h=c[d];S(h!=null,`Previous layout not found for panel index ${d}`);const y=h+p,b=K({panelConstraints:n[d],size:y});if(l[d]=b,!D(b,y)){let g=y-b,w=e<0?m:u;for(;w>=0&&w<n.length;){const j=l[w];S(j!=null,`Previous layout not found for panel index ${w}`);const M=j+g,N=K({panelConstraints:n[w],size:M});if(D(j,N)||(g-=N-j,l[w]=N),D(g,0))break;e>0?w--:w++}}}const x=Object.values(l).reduce((d,h)=>h+d,0);if(!D(x,100,.1))return s;const f=Object.keys(s);return l.reduce((d,h,y)=>(d[f[y]]=h,d),{})}function pe(e){const{mountedGroups:t}=T();for(const[n]of t)if(n.separators.some(r=>r.element===e))return n;throw Error("Could not find parent Group for separator element")}function J(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const n in e)if(t[n]===void 0||re(e[n],t[n])!==0)return!1;return!0}function W({layout:e,panelConstraints:t}){const n=[...Object.values(e)],r=n.reduce((c,i)=>c+i,0);if(n.length!==t.length)throw Error(`Invalid ${t.length} panel layout: ${n.map(c=>`${c}%`).join(", ")}`);if(!D(r,100)&&n.length>0)for(let c=0;c<t.length;c++){const i=n[c];S(i!=null,`No layout data found for index ${c}`);const l=100/r*i;n[c]=l}let s=0;for(let c=0;c<t.length;c++){const i=n[c];S(i!=null,`No layout data found for index ${c}`);const l=K({panelConstraints:t[c],size:i});i!=l&&(s+=i-l,n[c]=l)}if(!D(s,0))for(let c=0;c<t.length;c++){const i=n[c];S(i!=null,`No layout data found for index ${c}`);const l=i+s,u=K({panelConstraints:t[c],size:l});if(i!==u&&(s-=u-i,n[c]=u,D(s,0)))break}const o=Object.keys(e);return n.reduce((c,i,l)=>(c[o[l]]=i,c),{})}function mt({groupId:e}){const t=()=>{const{mountedGroups:n}=T();for(const[r,s]of n)if(r.id===e)return{group:r,...s};throw Error(`Could not find Group with id "${e}"`)};return{getLayout(){const{defaultLayoutDeferred:n,layout:r}=t();return n?{}:r},setLayout(n){const{defaultLayoutDeferred:r,derivedPanelConstraints:s,group:o,layout:c,separatorToPanels:i}=t(),l=W({layout:n,panelConstraints:s});return r?c:(J(c,l)||R(u=>({mountedGroups:new Map(u.mountedGroups).set(o,{defaultLayoutDeferred:r,derivedPanelConstraints:s,layout:l,separatorToPanels:i})})),l)}}}function pt(e){const{mountedGroups:t}=T(),n=t.get(e);return S(n,`Mounted Group ${e.id} not found`),n}function U(e,t){const n=pe(e),r=pt(n),s=n.separators.find(m=>m.element===e);S(s,"Matching separator not found");const o=r.separatorToPanels.get(s);S(o,"Matching panels not found");const c=o.map(m=>n.panels.indexOf(m)),i=mt({groupId:n.id}).getLayout(),l=ae({delta:t,initialLayout:i,panelConstraints:r.derivedPanelConstraints,pivotIndices:c,prevLayout:i,trigger:"keyboard"}),u=W({layout:l,panelConstraints:r.derivedPanelConstraints});J(i,u)||R(m=>({mountedGroups:new Map(m.mountedGroups).set(n,{defaultLayoutDeferred:r.defaultLayoutDeferred,derivedPanelConstraints:r.derivedPanelConstraints,layout:u,separatorToPanels:r.separatorToPanels})}))}function Be(e){if(e.defaultPrevented)return;const t=e.currentTarget,n=pe(t);if(!n.disabled)switch(e.key){case"ArrowDown":{e.preventDefault(),n.orientation==="vertical"&&U(t,5);break}case"ArrowLeft":{e.preventDefault(),n.orientation==="horizontal"&&U(t,-5);break}case"ArrowRight":{e.preventDefault(),n.orientation==="horizontal"&&U(t,5);break}case"ArrowUp":{e.preventDefault(),n.orientation==="vertical"&&U(t,-5);break}case"End":{e.preventDefault(),U(t,100);break}case"Enter":{e.preventDefault();const r=pe(t),{derivedPanelConstraints:s,layout:o,separatorToPanels:c}=pt(r),i=r.separators.find(p=>p.element===t);S(i,"Matching separator not found");const l=c.get(i);S(l,"Matching panels not found");const u=l[0],m=s.find(p=>p.panelId===u.id);if(S(m,"Panel metadata not found"),m.collapsible){const p=o[u.id],x=m.collapsedSize===p?r.inMemoryLastExpandedPanelSizes[u.id]??m.minSize:m.collapsedSize;U(t,x-p)}break}case"F6":{e.preventDefault();const r=pe(t).separators.map(c=>c.element),s=Array.from(r).findIndex(c=>c===e.currentTarget);S(s!==null,"Index not found");const o=e.shiftKey?s>0?s-1:r.length-1:s+1<r.length?s+1:0;r[o].focus();break}case"Home":{e.preventDefault(),U(t,-100);break}}}const zn=e=>e,we=()=>{},ht=1,xt=2,gt=4,yt=8,Ke={coarse:10,precise:5};function kn(e,t,n){let r,s={x:1/0,y:1/0};for(const o of t){const c=dt(n,o.rect);switch(e){case"horizontal":{c.x<=s.x&&(r=o,s=c);break}case"vertical":{c.y<=s.y&&(r=o,s=c);break}}}return r?{distance:s,hitRegion:r}:void 0}let fe;function Dn(){return fe===void 0&&(typeof matchMedia=="function"?fe=!!matchMedia("(pointer:coarse)").matches:fe=!1),fe}function Ln(e){return e!==null&&typeof e=="object"&&"nodeType"in e&&e.nodeType===Node.DOCUMENT_FRAGMENT_NODE}function Pn(e,t){if(e===t)throw new Error("Cannot compare node with itself");const n={a:Je(e),b:Je(t)};let r;for(;n.a.at(-1)===n.b.at(-1);)e=n.a.pop(),t=n.b.pop(),r=e;S(r,"Stacking order can only be calculated for elements with a common ancestor");const s={a:Qe(Ye(n.a)),b:Qe(Ye(n.b))};if(s.a===s.b){const o=r.childNodes,c={a:n.a.at(-1),b:n.b.at(-1)};let i=o.length;for(;i--;){const l=o[i];if(l===c.a)return 1;if(l===c.b)return-1}}return Math.sign(s.a-s.b)}const En=/\b(?:position|zIndex|opacity|transform|webkitTransform|mixBlendMode|filter|webkitFilter|isolation)\b/;function Rn(e){const t=getComputedStyle(vt(e)??e).display;return t==="flex"||t==="inline-flex"}function In(e){const t=getComputedStyle(e);return!!(t.position==="fixed"||t.zIndex!=="auto"&&(t.position!=="static"||Rn(e))||+t.opacity<1||"transform"in t&&t.transform!=="none"||"webkitTransform"in t&&t.webkitTransform!=="none"||"mixBlendMode"in t&&t.mixBlendMode!=="normal"||"filter"in t&&t.filter!=="none"||"webkitFilter"in t&&t.webkitFilter!=="none"||"isolation"in t&&t.isolation==="isolate"||En.test(t.willChange)||t.webkitOverflowScrolling==="touch")}function Ye(e){let t=e.length;for(;t--;){const n=e[t];if(S(n,"Missing node"),In(n))return n}return null}function Qe(e){return e&&Number(getComputedStyle(e).zIndex)||0}function Je(e){const t=[];for(;e;)t.push(e),e=vt(e);return t}function vt(e){const{parentNode:t}=e;return Ln(t)?t.host:t}function Tn(e,t){return e.x<t.x+t.width&&e.x+e.width>t.x&&e.y<t.y+t.height&&e.y+e.height>t.y}function $n({groupElement:e,hitRegion:t,pointerEventTarget:n}){if(!ut(n)||n.contains(e)||e.contains(n))return!0;if(Pn(n,e)>0){let r=n;for(;r;){if(r.contains(e))return!0;if(Tn(r.getBoundingClientRect(),t))return!1;r=r.parentElement}}return!0}function wt(e,t){const n=[];return t.forEach((r,s)=>{if(s.disabled)return;const o=Dn()?Ke.coarse:Ke.precise,c=ft(s),i=kn(s.orientation,c,{x:e.clientX,y:e.clientY});i&&i.distance.x<=o&&i.distance.y<=o&&$n({groupElement:s.element,hitRegion:i.hitRegion.rect,pointerEventTarget:e.target})&&n.push(i.hitRegion)}),n}function Ze(e){if(e.defaultPrevented||e.pointerType==="mouse"&&e.button>0)return;const{mountedGroups:t}=T(),n=wt(e,t),r=new Set,s=new Set,o=new Set,c=new Map;let i=!1;n.forEach(l=>{r.add(l.group),l.panels.forEach(m=>{s.add(m)}),l.separator&&(o.add(l.separator),i||(i=!0,l.separator.element.focus()));const u=t.get(l.group);u&&c.set(l.group,u.layout)}),R({interactionState:{hitRegions:n,initialLayoutMap:c,pointerDownAtPoint:{x:e.clientX,y:e.clientY},state:"active"}}),n.length&&e.preventDefault()}function Fn({cursorFlags:e,groups:t,state:n}){let r=0,s=0;switch(n){case"active":case"hover":t.forEach(o=>{if(!o.disableCursor)switch(o.orientation){case"horizontal":{r++;break}case"vertical":{s++;break}}})}if(r===0&&s===0)return null;switch(n){case"active":{const o=(e&ht)!==0,c=(e&xt)!==0,i=(e&gt)!==0,l=(e&yt)!==0;if(e){if(o)return i?"se-resize":l?"ne-resize":"e-resize";if(c)return i?"sw-resize":l?"nw-resize":"w-resize";if(i)return"s-resize";if(l)return"n-resize"}break}}return r>0&&s>0?"move":r>0?"ew-resize":"ns-resize"}const et=new WeakMap;function Se(e){if(e.defaultView===null||e.defaultView===void 0)return;let{prevStyle:t,styleSheet:n}=et.get(e)??{};n===void 0&&(n=new e.defaultView.CSSStyleSheet,e.adoptedStyleSheets=[n]);const{cursorFlags:r,interactionState:s}=T();switch(s.state){case"active":case"hover":{const o=Fn({cursorFlags:r,groups:s.hitRegions.map(i=>i.group),state:s.state}),c=`*{cursor: ${o} !important; ${s.state==="active"?"touch-action: none;":""} }`;if(t===c)return;t=c,o?n.cssRules.length===0?n.insertRule(c):n.replaceSync(c):n.cssRules.length===1&&n.deleteRule(0);break}case"inactive":{t=void 0,n.cssRules.length===1&&n.deleteRule(0);break}}et.set(e,{prevStyle:t,styleSheet:n})}function bt({document:e,event:t,hitRegions:n,initialLayoutMap:r,mountedGroups:s,pointerDownAtPoint:o}){let c=0;const i=new Map(s);n.forEach(l=>{const{group:u,groupSize:m}=l,{disableCursor:p,orientation:x,panels:f}=u;let d=0;o?x==="horizontal"?d=(t.clientX-o.x)/m*100:d=(t.clientY-o.y)/m*100:x==="horizontal"?d=t.clientX<0?-100:100:d=t.clientY<0?-100:100;const h=r.get(u),{defaultLayoutDeferred:y,derivedPanelConstraints:b,layout:g,separatorToPanels:w}=s.get(u)??{defaultLayoutDeferred:!1};if(b&&h&&g&&w){const j=ae({delta:d,initialLayout:h,panelConstraints:b,pivotIndices:l.panels.map(M=>f.indexOf(M)),prevLayout:g,trigger:"mouse-or-touch"});if(J(j,g)){if(d!==0&&!p)switch(x){case"horizontal":{c|=d<0?ht:xt;break}case"vertical":{c|=d<0?gt:yt;break}}}else{i.set(l.group,{defaultLayoutDeferred:y,derivedPanelConstraints:b,layout:j,separatorToPanels:w});const M=l.group.panels.map(({id:N})=>N).join(",");l.group.inMemoryLayouts[M]=j}}}),R({cursorFlags:c,mountedGroups:i}),Se(e)}function tt(e){const{interactionState:t,mountedGroups:n}=T();t.state==="active"&&bt({document:e.currentTarget,event:e,hitRegions:t.hitRegions,initialLayoutMap:t.initialLayoutMap,mountedGroups:n})}function nt(e){if(e.defaultPrevented)return;const{interactionState:t,mountedGroups:n}=T();switch(t.state){case"active":{if(e.buttons===0){R(r=>r.interactionState.state==="inactive"?r:{cursorFlags:0,interactionState:{state:"inactive"}});return}bt({document:e.currentTarget,event:e,hitRegions:t.hitRegions,initialLayoutMap:t.initialLayoutMap,mountedGroups:n,pointerDownAtPoint:t.pointerDownAtPoint});break}default:{const r=wt(e,n);r.length===0?t.state!=="inactive"&&R({interactionState:{state:"inactive"}}):R({interactionState:{hitRegions:r,state:"hover"}}),Se(e.currentTarget);break}}}function rt(e){if(e.defaultPrevented||e.pointerType==="mouse"&&e.button>0)return;const{interactionState:t}=T();t.state==="active"&&(R({cursorFlags:0,interactionState:{state:"inactive"}}),t.hitRegions.length>0&&(Se(e.currentTarget),e.preventDefault()))}function at(e){let t=0,n=0;const r={};for(const o of e)if(o.defaultSize!==void 0){t++;const c=I(o.defaultSize);n+=c,r[o.panelId]=c}else r[o.panelId]=void 0;const s=e.length-t;if(s!==0){const o=I((100-n)/s);for(const c of e)c.defaultSize===void 0&&(r[c.panelId]=o)}return r}function Gn(e,t,n){if(!n[0])return;const r=e.panels.find(l=>l.element===t);if(!r||!r.onResize)return;const s=Q({group:e}),o=e.orientation==="horizontal"?r.element.offsetWidth:r.element.offsetHeight,c=r.mutableValues.prevSize,i={asPercentage:I(o/s*100),inPixels:o};r.mutableValues.prevSize=i,r.onResize(i,r.id,c)}function An(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const n in e)if(e[n]!==t[n])return!1;return!0}function On(e,t){const n=e.map(s=>s.id),r=Object.keys(t);if(n.length!==r.length)return!1;for(const s of n)if(!r.includes(s))return!1;return!0}const B=new Map;function qn(e){let t=!0;S(e.element.ownerDocument.defaultView,"Cannot register an unmounted Group");const n=e.element.ownerDocument.defaultView.ResizeObserver,r=new Set,s=new Set,o=new n(d=>{for(const h of d){const{borderBoxSize:y,target:b}=h;if(b===e.element){if(t){if(Q({group:e})===0)return;R(g=>{const w=g.mountedGroups.get(e);if(w){const j=Xe(e),M=w.defaultLayoutDeferred?at(j):w.layout,N=W({layout:M,panelConstraints:j});return!w.defaultLayoutDeferred&&J(M,N)&&An(w.derivedPanelConstraints,j)?g:{mountedGroups:new Map(g.mountedGroups).set(e,{defaultLayoutDeferred:!1,derivedPanelConstraints:j,layout:N,separatorToPanels:w.separatorToPanels})}}return g})}}else Gn(e,b,y)}});o.observe(e.element),e.panels.forEach(d=>{S(!r.has(d.id),`Panel ids must be unique; id "${d.id}" was used more than once`),r.add(d.id),d.onResize&&o.observe(d.element)});const c=Q({group:e}),i=Xe(e),l=e.panels.map(({id:d})=>d).join(",");let u=e.defaultLayout;u&&(On(e.panels,u)||(u=void 0));const m=e.inMemoryLayouts[l]??u??at(i),p=W({layout:m,panelConstraints:i}),x=ft(e),f=e.element.ownerDocument;return R(d=>{const h=new Map;return B.set(f,(B.get(f)??0)+1),x.forEach(y=>{y.separator&&h.set(y.separator,y.panels)}),{mountedGroups:new Map(d.mountedGroups).set(e,{defaultLayoutDeferred:c===0,derivedPanelConstraints:i,layout:p,separatorToPanels:h})}}),e.separators.forEach(d=>{S(!s.has(d.id),`Separator ids must be unique; id "${d.id}" was used more than once`),s.add(d.id),d.element.addEventListener("keydown",Be)}),B.get(f)===1&&(f.addEventListener("pointerdown",Ze,!0),f.addEventListener("pointerleave",tt),f.addEventListener("pointermove",nt),f.addEventListener("pointerup",rt,!0)),function(){t=!1,B.set(f,Math.max(0,(B.get(f)??0)-1)),R(d=>{const h=new Map(d.mountedGroups);return h.delete(e),{mountedGroups:h}}),e.separators.forEach(d=>{d.element.removeEventListener("keydown",Be)}),B.get(f)||(f.removeEventListener("pointerdown",Ze,!0),f.removeEventListener("pointerleave",tt),f.removeEventListener("pointermove",nt),f.removeEventListener("pointerup",rt,!0)),o.disconnect()}}function jt(){const[e,t]=v.useState({}),n=v.useCallback(()=>t({}),[]);return[e,n]}function _e(e){const t=v.useId();return`${e??t}`}const V=typeof window<"u"?v.useLayoutEffect:v.useEffect;function xe(e){const t=v.useRef(e);return V(()=>{t.current=e},[e]),v.useCallback((...n)=>t.current?.(...n),[t])}function Ne(...e){return xe(t=>{e.forEach(n=>{if(n)switch(typeof n){case"function":{n(t);break}case"object":{n.current=t;break}}})})}function Un(e){const t=v.useRef({...e});return V(()=>{for(const n in e)t.current[n]=e[n]},[e]),t.current}const St=v.createContext(null);function Hn(e,t){const n=v.useRef({getLayout:()=>({}),setLayout:zn});v.useImperativeHandle(t,()=>n.current,[]),V(()=>{Object.assign(n.current,mt({groupId:e}))})}function _t({children:e,className:t,defaultLayout:n,disableCursor:r,disabled:s,elementRef:o,groupRef:c,id:i,onLayoutChange:l,orientation:u="horizontal",style:m,...p}){const x=v.useRef({}),f=xe(_=>{J(x.current,_)||(x.current=_,l?.(_))}),d=_e(i),h=v.useRef(null),[y,b]=jt(),g=v.useRef({lastExpandedPanelSizes:{},layouts:{},panels:[],separators:[]}),w=Ne(h,o);Hn(d,c);const j=xe((_,C)=>{const{interactionState:k,mountedGroups:O}=T();for(const F of O.keys())if(F.id===_){const X=O.get(F);if(X){let le=!1;return k.state==="active"&&(le=k.hitRegions.some(q=>q.group===F)),{flexGrow:X.layout[C]??1,pointerEvents:le?"none":void 0}}}return{flexGrow:n?.[C]??1}}),M=v.useMemo(()=>({getPanelStyles:j,id:d,orientation:u,registerPanel:_=>{const C=g.current;return C.panels=be(u,[...C.panels,_]),b(),()=>{C.panels=C.panels.filter(k=>k!==_),b()}},registerSeparator:_=>{const C=g.current;return C.separators=be(u,[...C.separators,_]),b(),()=>{C.separators=C.separators.filter(k=>k!==_),b()}}}),[j,d,b,u]),N=Un({defaultLayout:n,disableCursor:r}),$=v.useRef(null);return V(()=>{const _=h.current;if(_===null)return;const C=g.current,k={defaultLayout:N.defaultLayout,disableCursor:!!N.disableCursor,disabled:!!s,element:_,id:d,inMemoryLastExpandedPanelSizes:g.current.lastExpandedPanelSizes,inMemoryLayouts:g.current.layouts,orientation:u,panels:C.panels,separators:C.separators};$.current=k;const O=qn(k),F=T().mountedGroups.get(k);if(F){const{defaultLayoutDeferred:q,derivedPanelConstraints:ce,layout:ge}=F;!q&&ce.length>0&&(f?.(ge),C.panels.forEach(ye=>{ye.scheduleUpdate()}))}const X=H.addListener("interactionStateChange",()=>{C.panels.forEach(q=>{q.scheduleUpdate()})}),le=H.addListener("mountedGroupsChange",q=>{const ce=q.get(k);if(ce){const{defaultLayoutDeferred:ge,derivedPanelConstraints:ye,layout:Mt}=ce;if(ge||ye.length===0)return;f?.(Mt),C.panels.forEach(zt=>{zt.scheduleUpdate()})}});return()=>{$.current=null,O(),X(),le()}},[s,d,f,u,y,N]),v.useEffect(()=>{const _=$.current;_&&(_.defaultLayout=n,_.disableCursor=!!r)}),a.jsx(St.Provider,{value:M,children:a.jsx("div",{...p,"aria-orientation":u,className:t,"data-group":!0,"data-testid":d,id:d,ref:w,style:{height:"100%",width:"100%",overflow:"hidden",...m,display:"flex",flexDirection:u==="horizontal"?"row":"column",flexWrap:"nowrap"},children:e})})}_t.displayName="Group";function Ce(){const e=v.useContext(St);return S(e,"Group Context not found; did you render a Panel or Separator outside of a Group?"),e}function Wn({groupId:e,panelId:t}){const n=()=>{const{mountedGroups:i}=T();for(const[l,{defaultLayoutDeferred:u,derivedPanelConstraints:m,layout:p,separatorToPanels:x}]of i)if(l.id===e)return{defaultLayoutDeferred:u,derivedPanelConstraints:m,group:l,layout:p,separatorToPanels:x};throw Error(`Group ${e} not found`)},r=()=>{const i=n().derivedPanelConstraints.find(l=>l.panelId===t);if(i!==void 0)return i;throw Error(`Panel constraints not found for Panel ${t}`)},s=()=>{const i=n().group.panels.find(l=>l.id===t);if(i!==void 0)return i;throw Error(`Layout not found for Panel ${t}`)},o=()=>{const i=n().layout[t];if(i!==void 0)return i;throw Error(`Layout not found for Panel ${t}`)},c=i=>{const l=o();if(i===l)return;const{defaultLayoutDeferred:u,derivedPanelConstraints:m,group:p,layout:x,separatorToPanels:f}=n(),d=p.panels.findIndex(g=>g.id===t),h=d===p.panels.length-1,y=ae({delta:h?l-i:i-l,initialLayout:x,panelConstraints:m,pivotIndices:h?[d-1,d]:[d,d+1],prevLayout:x,trigger:"imperative-api"}),b=W({layout:y,panelConstraints:m});J(x,b)||R(g=>({mountedGroups:new Map(g.mountedGroups).set(p,{defaultLayoutDeferred:u,derivedPanelConstraints:m,layout:b,separatorToPanels:f})}))};return{collapse:()=>{const{collapsible:i,collapsedSize:l}=r(),{mutableValues:u}=s(),m=o();i&&m!==l&&(u.expandToSize=m,c(l))},expand:()=>{const{collapsible:i,collapsedSize:l,minSize:u}=r(),{mutableValues:m}=s(),p=o();if(i&&p===l){let x=m.expandToSize??u;x===0&&(x=1),c(x)}},getSize:()=>{const{group:i}=n(),l=o(),{element:u}=s(),m=i.orientation==="horizontal"?u.offsetWidth:u.offsetHeight;return{asPercentage:l,inPixels:m}},isCollapsed:()=>{const{collapsible:i,collapsedSize:l}=r(),u=o();return i&&D(l,u)},resize:i=>{if(o()!==i){let l;switch(typeof i){case"number":{const{group:u}=n(),m=Q({group:u});l=I(i/m*100);break}case"string":{l=parseFloat(i);break}}c(l)}}}}function Vn(e,t){const{id:n}=Ce(),r=v.useRef({collapse:we,expand:we,getSize:()=>({asPercentage:0,inPixels:0}),isCollapsed:()=>!1,resize:we});v.useImperativeHandle(t,()=>r.current,[]),V(()=>{Object.assign(r.current,Wn({groupId:n,panelId:e}))})}function Nt({children:e,className:t,collapsedSize:n="0%",collapsible:r=!1,defaultSize:s,elementRef:o,id:c,maxSize:i="100%",minSize:l="0%",onResize:u,panelRef:m,style:p,...x}){const f=!!c,d=_e(c),h=v.useRef(null),y=Ne(h,o),[,b]=jt(),{getPanelStyles:g,id:w,registerPanel:j}=Ce(),M=u!==null,N=xe((_,C,k)=>{u?.(_,c,k)});V(()=>{const _=h.current;if(_!==null)return j({element:_,id:d,idIsStable:f,mutableValues:{expandToSize:void 0,prevSize:void 0},onResize:M?N:void 0,panelConstraints:{collapsedSize:n,collapsible:r,defaultSize:s,maxSize:i,minSize:l},scheduleUpdate:b})},[n,r,s,b,M,d,f,i,l,N,j]),Vn(d,m);const $=g(w,d);return a.jsx("div",{...x,"data-panel":!0,"data-testid":d,id:d,ref:y,style:{...Xn,flexBasis:0,flexShrink:1,overflow:"hidden",...$},children:a.jsx("div",{className:t,style:{width:"100%",height:"100%",...p},children:e})})}Nt.displayName="Panel";const Xn={minHeight:0,maxHeight:"100%",height:"auto",minWidth:0,maxWidth:"100%",width:"auto",border:"none",borderWidth:0,padding:0,margin:0};function Bn({layout:e,panelConstraints:t,panelId:n,panelIndex:r}){let s,o;const c=e[n],i=t.find(l=>l.panelId===n);if(i){const l=i.maxSize,u=o=i.collapsible?i.collapsedSize:i.minSize,m=[r,r+1];o=W({layout:ae({delta:u-c,initialLayout:e,panelConstraints:t,pivotIndices:m,prevLayout:e,trigger:"keyboard"}),panelConstraints:t})[n],s=W({layout:ae({delta:l-c,initialLayout:e,panelConstraints:t,pivotIndices:m,prevLayout:e,trigger:"keyboard"}),panelConstraints:t})[n]}return{valueControls:n,valueMax:s,valueMin:o,valueNow:c}}function Ct({children:e,className:t,elementRef:n,id:r,style:s,...o}){const c=_e(r),[i,l]=v.useState({}),[u,m]=v.useState("inactive"),p=v.useRef(null),x=Ne(p,n),{id:f,orientation:d,registerSeparator:h}=Ce(),y=d==="horizontal"?"vertical":"horizontal";return V(()=>{const b=p.current;if(b!==null){const g={element:b,id:c},w=h(g),j=H.addListener("interactionStateChange",N=>{m(N.state!=="inactive"&&N.hitRegions.some($=>$.separator===g)?N.state:"inactive")}),M=H.addListener("mountedGroupsChange",N=>{N.forEach(({derivedPanelConstraints:$,layout:_,separatorToPanels:C},k)=>{if(k.id===f){const O=C.get(g);if(O){const F=O[0],X=k.panels.indexOf(F);l(Bn({layout:_,panelConstraints:$,panelId:F.id,panelIndex:X}))}}})});return()=>{j(),M(),w()}}},[f,c,h]),a.jsx("div",{...o,"aria-controls":i.valueControls,"aria-orientation":y,"aria-valuemax":i.valueMax,"aria-valuemin":i.valueMin,"aria-valuenow":i.valueNow,children:e,className:t,"data-separator":u,"data-testid":c,id:c,ref:x,role:"separator",style:{flexBasis:"auto",...s,flexGrow:0,flexShrink:0},tabIndex:0})}Ct.displayName="Separator";const Kn=({className:e,...t})=>a.jsx(_t,{className:E("flex h-full w-full data-[panel-group-direction=vertical]:flex-col",e),...t}),st=Nt,Yn=({withHandle:e,className:t,...n})=>a.jsx(Ct,{className:E("relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90",t),...n,children:e&&a.jsx("div",{className:"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border",children:a.jsx(en,{className:"h-2.5 w-2.5"})})});function Qn(e){const[t,n]=v.useState(()=>typeof window<"u"?window.matchMedia(e).matches:!1);return v.useEffect(()=>{if(typeof window>"u")return;const r=window.matchMedia(e);n(r.matches);const s=o=>{n(o.matches)};return r.addEventListener("change",s),()=>r.removeEventListener("change",s)},[e]),t}function yr(){const e=kt(),[t,n]=v.useState(),[r,s]=v.useState(!0),{data:o}=dn(t),{mutate:c}=mn(),i=Qn("(max-width: 768px)");v.useEffect(()=>{(async()=>{const{data:{session:d}}=await z.auth.getSession();d||e("/auth",{replace:!0})})()},[e]);const l=f=>{n(f.id),i&&s(!1)},u=()=>{i&&(s(!0),n(void 0))},m=()=>{t&&(c(t),n(void 0),i&&s(!0))},p=f=>f?.other_user?f.other_user.first_name&&f.other_user.last_name?`${f.other_user.first_name} ${f.other_user.last_name}`:f.other_user.email||"Unknown":"Unknown",x=f=>f?.other_user?f.other_user.first_name&&f.other_user.last_name?`${f.other_user.first_name[0]}${f.other_user.last_name[0]}`.toUpperCase():f.other_user.email?.[0]?.toUpperCase()||"?":"?";return i?a.jsx("div",{className:"h-[calc(100vh-4rem)] flex flex-col",children:r?a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[a.jsx("h1",{className:"text-xl font-semibold",children:"Messages"}),a.jsx(Ve,{onConversationCreated:f=>{n(f),s(!1)}})]}),a.jsx("div",{className:"flex-1 overflow-hidden",children:a.jsx(Ue,{selectedId:t,onSelect:l})})]}):a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"flex items-center gap-3 p-4 border-b",children:[a.jsx(G,{variant:"ghost",size:"icon",onClick:u,children:a.jsx(Et,{className:"h-5 w-5"})}),a.jsxs(te,{className:"h-9 w-9",children:[a.jsx(he,{src:o?.other_user?.avatar_url||void 0}),a.jsx(ne,{children:x(o)})]}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("p",{className:"font-medium truncate",children:p(o)}),o?.property&&a.jsxs("p",{className:"text-xs text-muted-foreground truncate",children:[o.property.name,o.unit?.unit_number&&` - Unit ${o.unit.unit_number}`]})]}),a.jsxs(Re,{children:[a.jsx(Ie,{asChild:!0,children:a.jsx(G,{variant:"ghost",size:"icon",children:a.jsx(Te,{className:"h-5 w-5"})})}),a.jsx($e,{align:"end",children:a.jsxs(Fe,{onClick:m,children:[a.jsx(Ge,{className:"h-4 w-4 mr-2"}),"Archive"]})})]})]}),a.jsx("div",{className:"flex-1 flex flex-col overflow-hidden",children:t?a.jsxs(a.Fragment,{children:[a.jsx(He,{conversationId:t}),a.jsx(We,{conversationId:t})]}):a.jsx("div",{className:"flex-1 flex items-center justify-center text-muted-foreground",children:"Select a conversation"})})]})}):a.jsx("div",{className:"h-[calc(100vh-4rem)] p-6",children:a.jsx(Qt,{className:"h-full overflow-hidden",children:a.jsxs(Kn,{direction:"horizontal",children:[a.jsx(st,{defaultSize:30,minSize:20,maxSize:40,children:a.jsxs("div",{className:"h-full flex flex-col border-r",children:[a.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[a.jsx("h1",{className:"text-lg font-semibold",children:"Messages"}),a.jsx(Ve,{onConversationCreated:f=>n(f)})]}),a.jsx("div",{className:"flex-1 overflow-hidden",children:a.jsx(Ue,{selectedId:t,onSelect:l})})]})}),a.jsx(Yn,{withHandle:!0}),a.jsx(st,{defaultSize:70,children:a.jsx("div",{className:"h-full flex flex-col",children:o?a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"flex items-center gap-3 p-4 border-b",children:[a.jsxs(te,{className:"h-10 w-10",children:[a.jsx(he,{src:o.other_user?.avatar_url||void 0}),a.jsx(ne,{children:x(o)})]}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("p",{className:"font-medium",children:p(o)}),a.jsxs("div",{className:"flex items-center gap-1.5 text-sm text-muted-foreground",children:[a.jsx(it,{className:"h-3.5 w-3.5"}),a.jsxs("span",{className:"truncate",children:[o.property?.name,o.unit?.unit_number&&` - Unit ${o.unit.unit_number}`]})]})]}),a.jsxs(Re,{children:[a.jsx(Ie,{asChild:!0,children:a.jsx(G,{variant:"ghost",size:"icon",children:a.jsx(Te,{className:"h-5 w-5"})})}),a.jsx($e,{align:"end",children:a.jsxs(Fe,{onClick:m,children:[a.jsx(Ge,{className:"h-4 w-4 mr-2"}),"Archive conversation"]})})]})]}),a.jsx(He,{conversationId:o.id}),a.jsx(We,{conversationId:o.id})]}):a.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center text-muted-foreground",children:[a.jsx(ot,{className:"h-16 w-16 mb-4 opacity-30"}),a.jsx("p",{className:"text-lg font-medium",children:"Select a conversation"}),a.jsx("p",{className:"text-sm",children:"Choose a conversation from the sidebar to start messaging"})]})})})]})})})}export{yr as default};
