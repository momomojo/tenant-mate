import{u as Q,b as Y,c as te,j as e}from"./vendor-query-BBSsXiBS.js";import{a as x,u as fe}from"./vendor-react-Cua_SOQ2.js";import{c as G,s as j,h as re,B as ve,b as U,I as N,S as B,d as H,e as z,f as X,g as D,u as se,L as F,a as ye,F as be,p as I,q as T,r as P,t as M,v as R,w as Ne,x as we,z as A,U as ne}from"./index-De75nt2H.js";import{u as L,S as Se}from"./useAuthenticatedUser-DxFjEeTf.js";import{U as ie,a as Ce,S as _e,A as Ae}from"./AppSidebar-BMrVA_Jp.js";import{T as ke}from"./TopBar-ioa75gCp.js";import{B as De}from"./badge-COPlmVyV.js";import{C as k,a as E,c as $,b as K}from"./card-nJjNL--Z.js";import{D as qe,a as Fe,E as Ie,b as Te,c as V,d as Pe}from"./dropdown-menu-ADG-5tNT.js";import{C as Me}from"./circle-check-big-Cj9dHWRz.js";import{C as Ee}from"./circle-x-Dmf2Egdb.js";import{T as $e,A as Ue,a as Le,b as Re,c as Ke,d as Ve,e as Oe,f as Qe,g as Be}from"./alert-dialog-CYp6Xfqu.js";import{M as He}from"./mail-DsNYd1qp.js";import{f as W}from"./format-BJjq1L2l.js";import{S as ze}from"./search-CHJz-TVc.js";import{D as le,a as Xe,b as oe,c as ce,d as de,e as ue}from"./dialog-CU0zoF6x.js";import{L as me}from"./loader-circle-CxRwcVV4.js";import{u as Je}from"./useUnits-BY5QSTqu.js";import{C as We}from"./checkbox-DQT27pwU.js";import{b as Ye}from"./addYears-CGq75uKQ.js";import{T as Ge,a as Ze,b as O,c as et}from"./tabs-BX6TOnl4.js";import{C as tt}from"./clock-D6Y4OkTG.js";import"./vendor-ui-Dpa_eFEd.js";import"./vendor-supabase-By2EX_dj.js";import"./scroll-area-DovF1kS9.js";import"./chevron-right-BxT_eo_W.js";import"./circle-C417sgD2.js";const pe=G("FileSearch",[["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M4.268 21a2 2 0 0 0 1.727 1H18a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v3",key:"ms7g94"}],["path",{d:"m9 18-1.5-1.5",key:"1j6qii"}],["circle",{cx:"5",cy:"14",r:"3",key:"ufru5t"}]]);const st=G("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);const he=G("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);const at=G("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]);function rt(t={}){const{user:a}=L();return Q({queryKey:["applicants",a?.id,t],queryFn:async()=>{if(!a)return[];let s=j.from("applicants").select(`
          *,
          property:properties!inner(id, name, address, created_by, property_manager_id),
          unit:units(id, unit_number)
        `).or(`property.created_by.eq.${a.id},property.property_manager_id.eq.${a.id}`).order("created_at",{ascending:!1});t.propertyId&&(s=s.eq("property_id",t.propertyId)),t.status&&(s=s.eq("status",t.status)),t.search&&(s=s.or(`first_name.ilike.%${t.search}%,last_name.ilike.%${t.search}%,email.ilike.%${t.search}%`));const{data:l,error:i}=await s;if(i)throw i;return l},enabled:!!a})}function nt(){const t=Y(),{user:a}=L();return te({mutationFn:async s=>{if(!a)throw new Error("Not authenticated");const{data:l,error:i}=await j.from("applicants").insert({property_id:s.propertyId,unit_id:s.unitId||null,email:s.email,first_name:s.firstName||null,last_name:s.lastName||null,phone:s.phone||null,status:"invited",invited_by:a.id}).select(`
          *,
          property:properties(id, name, address),
          unit:units(id, unit_number)
        `).single();if(i)throw i;return l},onSuccess:()=>{t.invalidateQueries({queryKey:["applicants"]})}})}function it(){const t=Y(),{user:a}=L();return te({mutationFn:async s=>{if(!a)throw new Error("Not authenticated");const l={};s.status&&(l.status=s.status,(s.status==="approved"||s.status==="rejected")&&(l.decided_by=a.id,l.decided_at=new Date().toISOString())),s.decisionNotes!==void 0&&(l.decision_notes=s.decisionNotes),s.applicationData&&(l.application_data=s.applicationData);const{data:i,error:p}=await j.from("applicants").update(l).eq("id",s.applicantId).select(`
          *,
          property:properties(id, name, address),
          unit:units(id, unit_number)
        `).single();if(p)throw p;return i},onSuccess:(s,l)=>{t.invalidateQueries({queryKey:["applicants"]}),t.invalidateQueries({queryKey:["applicant",l.applicantId]})}})}function lt(){const t=Y();return te({mutationFn:async a=>{const{error:s}=await j.from("applicants").delete().eq("id",a);if(s)throw s},onSuccess:()=>{t.invalidateQueries({queryKey:["applicants"]})}})}function ot(t){const{user:a}=L();return Q({queryKey:["applicant-counts",a?.id,t],queryFn:async()=>{if(!a)return{};let s=j.from("applicants").select(`
          status,
          property:properties!inner(created_by, property_manager_id)
        `).or(`property.created_by.eq.${a.id},property.property_manager_id.eq.${a.id}`);t&&(s=s.eq("property_id",t));const{data:l,error:i}=await s;if(i)return{};const p={total:0,invited:0,started:0,submitted:0,screening:0,approved:0,rejected:0,converted:0};return(l||[]).forEach(h=>{p.total++,p[h.status]!==void 0&&p[h.status]++}),p},enabled:!!a})}const ct={invited:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200",started:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200",submitted:"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200",screening:"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200",approved:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",rejected:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200",converted:"bg-emerald-100 text-emerald-800 dark:bg-emerald-900 dark:text-emerald-200",withdrawn:"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200"},dt={invited:"Invited",started:"In Progress",submitted:"Submitted",screening:"Screening",approved:"Approved",rejected:"Rejected",converted:"Converted",withdrawn:"Withdrawn"};function ut({applicant:t,onApprove:a,onReject:s,onStartScreening:l,onConvert:i,onDelete:p,onClick:h}){const g=t.first_name&&t.last_name?`${t.first_name} ${t.last_name}`:t.email,n=t.status==="submitted"||t.status==="screening",d=t.status!=="rejected"&&t.status!=="converted"&&t.status!=="withdrawn",b=t.status==="submitted",f=t.status==="approved";return e.jsxs(k,{className:re("transition-all hover:shadow-md",h&&"cursor-pointer"),onClick:h,children:[e.jsx(E,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h3",{className:"font-semibold text-lg leading-none",children:g}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(ve,{className:"h-3.5 w-3.5"}),e.jsxs("span",{children:[t.property?.name,t.unit?.unit_number&&` - Unit ${t.unit.unit_number}`]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(De,{className:re("font-medium",ct[t.status]),children:dt[t.status]}),e.jsxs(qe,{children:[e.jsx(Fe,{asChild:!0,onClick:o=>o.stopPropagation(),children:e.jsx(U,{variant:"ghost",size:"icon",className:"h-8 w-8",children:e.jsx(Ie,{className:"h-4 w-4"})})}),e.jsxs(Te,{align:"end",children:[b&&l&&e.jsxs(V,{onClick:o=>{o.stopPropagation(),l()},children:[e.jsx(pe,{className:"h-4 w-4 mr-2"}),"Start Screening"]}),n&&a&&e.jsxs(V,{onClick:o=>{o.stopPropagation(),a()},children:[e.jsx(Me,{className:"h-4 w-4 mr-2 text-green-600"}),"Approve"]}),d&&s&&e.jsxs(V,{onClick:o=>{o.stopPropagation(),s()},children:[e.jsx(Ee,{className:"h-4 w-4 mr-2 text-red-600"}),"Reject"]}),f&&i&&e.jsxs(V,{onClick:o=>{o.stopPropagation(),i()},children:[e.jsx(ie,{className:"h-4 w-4 mr-2 text-blue-600"}),"Convert to Tenant"]}),(b||n||d||f)&&e.jsx(Pe,{}),p&&e.jsxs(V,{className:"text-red-600",onClick:o=>{o.stopPropagation(),p()},children:[e.jsx($e,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]})]})]})}),e.jsx($,{className:"pt-0",children:e.jsxs("div",{className:"grid gap-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(He,{className:"h-4 w-4"}),e.jsx("a",{href:`mailto:${t.email}`,className:"hover:underline",onClick:o=>o.stopPropagation(),children:t.email})]}),t.phone&&e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(st,{className:"h-4 w-4"}),e.jsx("a",{href:`tel:${t.phone}`,className:"hover:underline",onClick:o=>o.stopPropagation(),children:t.phone})]}),e.jsxs("div",{className:"flex items-center justify-between mt-2 pt-2 border-t text-xs text-muted-foreground",children:[e.jsxs("span",{children:["Invited ",W(new Date(t.invited_at),"MMM d, yyyy")]}),t.application_submitted_at&&e.jsxs("span",{children:["Submitted ",W(new Date(t.application_submitted_at),"MMM d, yyyy")]})]})]})})]})}const mt=[{value:"",label:"All Statuses"},{value:"invited",label:"Invited"},{value:"started",label:"In Progress"},{value:"submitted",label:"Submitted"},{value:"screening",label:"Screening"},{value:"approved",label:"Approved"},{value:"rejected",label:"Rejected"},{value:"converted",label:"Converted"}];function pt({propertyId:t,onPropertyChange:a,status:s,onStatusChange:l,search:i,onSearchChange:p}){const{user:h}=L(),{data:g}=Q({queryKey:["my-properties",h?.id],queryFn:async()=>{if(!h)return[];const{data:n,error:d}=await j.from("properties").select("id, name").or(`created_by.eq.${h.id},property_manager_id.eq.${h.id}`);if(d)throw d;return n||[]},enabled:!!h});return e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"relative flex-1 max-w-xs",children:[e.jsx(ze,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(N,{value:i,onChange:n=>p(n.target.value),placeholder:"Search applicants...",className:"pl-9"})]}),e.jsxs(B,{value:t,onValueChange:a,children:[e.jsx(H,{className:"w-full sm:w-48",children:e.jsx(z,{placeholder:"All Properties"})}),e.jsxs(X,{children:[e.jsx(D,{value:"",children:"All Properties"}),g?.map(n=>e.jsx(D,{value:n.id,children:n.name},n.id))]})]}),e.jsxs(B,{value:s,onValueChange:l,children:[e.jsx(H,{className:"w-full sm:w-40",children:e.jsx(z,{placeholder:"All Statuses"})}),e.jsx(X,{children:mt.map(n=>e.jsx(D,{value:n.value,children:n.label},n.value))})]})]})}function ht({defaultPropertyId:t,onSuccess:a}){const[s,l]=x.useState(!1),[i,p]=x.useState(t||""),[h,g]=x.useState(""),[n,d]=x.useState(""),[b,f]=x.useState(""),[o,C]=x.useState(""),[q,r]=x.useState(""),{user:c}=L(),{toast:y}=se(),{mutateAsync:J,isPending:_}=nt(),{data:v}=Q({queryKey:["my-properties",c?.id],queryFn:async()=>{if(!c)return[];const{data:u,error:S}=await j.from("properties").select("id, name, address").or(`created_by.eq.${c.id},property_manager_id.eq.${c.id}`);if(S)throw S;return u||[]},enabled:!!c&&s}),{data:w}=Q({queryKey:["property-units",i],queryFn:async()=>{if(!i)return[];const{data:u,error:S}=await j.from("units").select("id, unit_number, status").eq("property_id",i).in("status",["vacant","available"]);if(S)throw S;return u||[]},enabled:!!i}),Z=()=>{t||p(""),g(""),d(""),f(""),C(""),r("")},ee=async u=>{if(u.preventDefault(),!i||!n){y({title:"Missing required fields",description:"Please select a property and enter an email address.",variant:"destructive"});return}try{await J({propertyId:i,unitId:h||void 0,email:n,firstName:b||void 0,lastName:o||void 0,phone:q||void 0}),y({title:"Applicant invited",description:`An invitation has been sent to ${n}`}),l(!1),Z(),a?.()}catch{y({title:"Error",description:"Failed to invite applicant. Please try again.",variant:"destructive"})}};return e.jsxs(le,{open:s,onOpenChange:l,children:[e.jsx(Xe,{asChild:!0,children:e.jsxs(U,{children:[e.jsx(ie,{className:"h-4 w-4 mr-2"}),"Invite Applicant"]})}),e.jsxs(oe,{className:"sm:max-w-md",children:[e.jsxs(ce,{children:[e.jsx(de,{children:"Invite Applicant"}),e.jsx(ue,{children:"Send an application invitation to a potential tenant"})]}),e.jsxs("form",{onSubmit:ee,className:"space-y-4 mt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"property",children:"Property *"}),e.jsxs(B,{value:i,onValueChange:p,children:[e.jsx(H,{id:"property",children:e.jsx(z,{placeholder:"Select a property"})}),e.jsx(X,{children:v?.map(u=>e.jsx(D,{value:u.id,children:u.name},u.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"unit",children:"Unit (optional)"}),e.jsxs(B,{value:h,onValueChange:g,disabled:!i,children:[e.jsx(H,{id:"unit",children:e.jsx(z,{placeholder:i?"Select a unit":"Select a property first"})}),e.jsxs(X,{children:[e.jsx(D,{value:"",children:"No specific unit"}),w?.map(u=>e.jsxs(D,{value:u.id,children:["Unit ",u.unit_number]},u.id))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"email",children:"Email *"}),e.jsx(N,{id:"email",type:"email",value:n,onChange:u=>d(u.target.value),placeholder:"applicant@email.com",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"firstName",children:"First Name"}),e.jsx(N,{id:"firstName",value:b,onChange:u=>f(u.target.value),placeholder:"John"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"lastName",children:"Last Name"}),e.jsx(N,{id:"lastName",value:o,onChange:u=>C(u.target.value),placeholder:"Doe"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"phone",children:"Phone"}),e.jsx(N,{id:"phone",type:"tel",value:q,onChange:u=>r(u.target.value),placeholder:"(555) 123-4567"})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(U,{type:"button",variant:"outline",onClick:()=>l(!1),children:"Cancel"}),e.jsx(U,{type:"submit",disabled:_,children:_?e.jsxs(e.Fragment,{children:[e.jsx(me,{className:"h-4 w-4 mr-2 animate-spin"}),"Sending..."]}):"Send Invitation"})]})]})]})]})}const xt=A.object({unitId:A.string().min(1,"Unit is required"),createLease:A.boolean().default(!0),leaseStart:A.string().optional(),leaseEnd:A.string().optional(),monthlyRent:A.coerce.number().optional(),securityDeposit:A.coerce.number().optional()});function jt({applicant:t,open:a,onOpenChange:s,onSuccess:l}){const{toast:i}=se(),p=Y(),[h,g]=x.useState(!1),{data:n}=Je(t.property_id),d=ye({resolver:we(xt),defaultValues:{unitId:t.unit_id||"",createLease:!0,leaseStart:W(new Date,"yyyy-MM-dd"),leaseEnd:W(Ye(new Date,1),"yyyy-MM-dd"),monthlyRent:0,securityDeposit:0}}),b=d.watch("createLease"),f=d.watch("unitId"),o=n?.find(r=>r.id===f);o?.rent_amount&&d.getValues("monthlyRent")===0&&d.setValue("monthlyRent",o.rent_amount);const C=async r=>{g(!0);try{let c;const{data:y,error:J}=await j.from("profiles").select("id, role").eq("email",t.email).maybeSingle();if(y)c=y.id,y.role!=="tenant"&&await j.from("profiles").update({role:"tenant"}).eq("id",c);else throw new Error(`No account found for ${t.email}. The applicant must create an account (sign up) before they can be converted to a tenant.`);await j.from("units").update({status:"occupied"}).eq("id",r.unitId);const{error:_}=await j.from("tenant_units").insert({tenant_id:c,unit_id:r.unitId,status:"active",move_in_date:r.leaseStart||new Date().toISOString()});if(_&&console.error("Error assigning tenant to unit:",_),r.createLease&&r.leaseStart&&r.leaseEnd){const{data:{user:v}}=await j.auth.getUser(),{error:w}=await j.from("leases").insert({property_id:t.property_id,unit_id:r.unitId,tenant_id:c,lease_start:r.leaseStart,lease_end:r.leaseEnd,monthly_rent:r.monthlyRent||o?.rent_amount||0,security_deposit:r.securityDeposit||0,status:"draft",created_by:v?.id});w&&console.error("Error creating lease:",w)}await j.from("applicants").update({status:"converted",converted_tenant_id:c,converted_at:new Date().toISOString()}).eq("id",t.id),p.invalidateQueries({queryKey:["applicants"]}),p.invalidateQueries({queryKey:["tenants"]}),p.invalidateQueries({queryKey:["units"]}),p.invalidateQueries({queryKey:["leases"]}),i({title:"Applicant converted",description:`${t.first_name||t.email} is now a tenant.`}),s(!1),l?.()}catch(c){console.error("Error converting applicant:",c),i({title:"Conversion failed",description:c instanceof Error?c.message:"Could not convert applicant. Please try again.",variant:"destructive"})}finally{g(!1)}},q=`${t.first_name||""} ${t.last_name||""}`.trim()||t.email;return e.jsx(le,{open:a,onOpenChange:s,children:e.jsxs(oe,{className:"max-w-md",children:[e.jsxs(ce,{children:[e.jsxs(de,{className:"flex items-center gap-2",children:[e.jsx(he,{className:"h-5 w-5"}),"Convert to Tenant"]}),e.jsxs(ue,{children:["Convert ",e.jsx("strong",{children:q})," from an applicant to an active tenant."]})]}),e.jsx(be,{...d,children:e.jsxs("form",{onSubmit:d.handleSubmit(C),className:"space-y-4",children:[e.jsx(I,{control:d.control,name:"unitId",render:({field:r})=>e.jsxs(T,{children:[e.jsx(P,{children:"Assign to Unit *"}),e.jsxs(B,{value:r.value,onValueChange:r.onChange,children:[e.jsx(M,{children:e.jsx(H,{children:e.jsx(z,{placeholder:"Select unit"})})}),e.jsx(X,{children:n?.map(c=>e.jsxs(D,{value:c.id,children:["Unit ",c.unit_number,c.status==="occupied"&&" (Occupied)",c.rent_amount&&` - $${c.rent_amount}/mo`]},c.id))})]}),e.jsx(R,{})]})}),e.jsx(I,{control:d.control,name:"createLease",render:({field:r})=>e.jsxs(T,{className:"flex flex-row items-start space-x-3 space-y-0 rounded-md border p-4",children:[e.jsx(M,{children:e.jsx(We,{checked:r.value,onCheckedChange:r.onChange})}),e.jsxs("div",{className:"space-y-1 leading-none",children:[e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"h-4 w-4"}),"Create lease agreement"]}),e.jsx(Ne,{children:"Automatically create a draft lease for this tenant"})]})]})}),b&&e.jsxs("div",{className:"space-y-4 rounded-md border p-4 bg-muted/30",children:[e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsx(I,{control:d.control,name:"leaseStart",render:({field:r})=>e.jsxs(T,{children:[e.jsx(P,{children:"Lease Start"}),e.jsx(M,{children:e.jsx(N,{type:"date",...r})}),e.jsx(R,{})]})}),e.jsx(I,{control:d.control,name:"leaseEnd",render:({field:r})=>e.jsxs(T,{children:[e.jsx(P,{children:"Lease End"}),e.jsx(M,{children:e.jsx(N,{type:"date",...r})}),e.jsx(R,{})]})})]}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsx(I,{control:d.control,name:"monthlyRent",render:({field:r})=>e.jsxs(T,{children:[e.jsx(P,{children:"Monthly Rent"}),e.jsx(M,{children:e.jsx(N,{type:"number",placeholder:o?.rent_amount?.toString()||"0",...r})}),e.jsx(R,{})]})}),e.jsx(I,{control:d.control,name:"securityDeposit",render:({field:r})=>e.jsxs(T,{children:[e.jsx(P,{children:"Security Deposit"}),e.jsx(M,{children:e.jsx(N,{type:"number",placeholder:"0",...r})}),e.jsx(R,{})]})})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(U,{type:"button",variant:"outline",onClick:()=>s(!1),disabled:h,children:"Cancel"}),e.jsxs(U,{type:"submit",disabled:h,children:[h&&e.jsx(me,{className:"h-4 w-4 mr-2 animate-spin"}),"Convert to Tenant"]})]})]})})]})})}function Qt(){const t=fe(),{toast:a}=se(),[s,l]=x.useState(""),[i,p]=x.useState(""),[h,g]=x.useState(""),[n,d]=x.useState("all"),[b,f]=x.useState(!1),[o,C]=x.useState(null),[q,r]=x.useState(!1),[c,y]=x.useState(null),{data:J,isLoading:_}=rt({propertyId:s||void 0,status:i||void 0,search:h||void 0}),{data:v}=ot(s||void 0),{mutate:w}=it(),{mutate:Z}=lt();x.useEffect(()=>{(async()=>{const{data:{session:ge}}=await j.auth.getSession();ge||t("/auth",{replace:!0})})()},[t]);const ee=m=>{w({applicantId:m,status:"approved"},{onSuccess:()=>{a({title:"Applicant approved",description:"The applicant has been approved and can now be converted to a tenant."})}})},u=m=>{w({applicantId:m,status:"rejected"},{onSuccess:()=>{a({title:"Applicant rejected",description:"The application has been rejected."})}})},S=m=>{w({applicantId:m,status:"screening"},{onSuccess:()=>{a({title:"Screening started",description:"Background and credit check has been initiated."})}})},xe=m=>{y(m),r(!0)},je=()=>{o&&Z(o,{onSuccess:()=>{a({title:"Applicant deleted",description:"The applicant has been removed."}),f(!1),C(null)}})},ae=J?.filter(m=>n==="all"?!0:n==="pending"?["invited","started","submitted"].includes(m.status):n==="screening"?m.status==="screening":n==="approved"?m.status==="approved":n==="rejected"?m.status==="rejected":!0);return e.jsxs(_e,{children:[e.jsxs("div",{className:"flex min-h-screen w-full bg-background",children:[e.jsx(Ae,{}),e.jsxs("main",{className:"flex-1 overflow-auto",children:[e.jsx(ke,{}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Applicants"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage rental applications and tenant screening"})]}),e.jsx(ht,{})]}),e.jsxs("div",{className:"grid gap-4 grid-cols-2 md:grid-cols-5",children:[e.jsxs(k,{children:[e.jsx(E,{className:"pb-2",children:e.jsx(K,{className:"text-sm font-medium text-muted-foreground",children:"Total"})}),e.jsx($,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-2xl font-bold",children:v?.total||0})]})})]}),e.jsxs(k,{children:[e.jsx(E,{className:"pb-2",children:e.jsx(K,{className:"text-sm font-medium text-muted-foreground",children:"Pending"})}),e.jsx($,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(tt,{className:"h-4 w-4 text-yellow-600"}),e.jsx("span",{className:"text-2xl font-bold",children:(v?.invited||0)+(v?.started||0)+(v?.submitted||0)})]})})]}),e.jsxs(k,{children:[e.jsx(E,{className:"pb-2",children:e.jsx(K,{className:"text-sm font-medium text-muted-foreground",children:"Screening"})}),e.jsx($,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"h-4 w-4 text-orange-600"}),e.jsx("span",{className:"text-2xl font-bold",children:v?.screening||0})]})})]}),e.jsxs(k,{children:[e.jsx(E,{className:"pb-2",children:e.jsx(K,{className:"text-sm font-medium text-muted-foreground",children:"Approved"})}),e.jsx($,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(he,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"text-2xl font-bold",children:v?.approved||0})]})})]}),e.jsxs(k,{children:[e.jsx(E,{className:"pb-2",children:e.jsx(K,{className:"text-sm font-medium text-muted-foreground",children:"Rejected"})}),e.jsx($,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(at,{className:"h-4 w-4 text-red-600"}),e.jsx("span",{className:"text-2xl font-bold",children:v?.rejected||0})]})})]})]}),e.jsx(pt,{propertyId:s,onPropertyChange:l,status:i,onStatusChange:p,search:h,onSearchChange:g}),e.jsxs(Ge,{value:n,onValueChange:d,children:[e.jsxs(Ze,{children:[e.jsx(O,{value:"all",children:"All"}),e.jsx(O,{value:"pending",children:"Pending"}),e.jsx(O,{value:"screening",children:"Screening"}),e.jsx(O,{value:"approved",children:"Approved"}),e.jsx(O,{value:"rejected",children:"Rejected"})]}),e.jsx(et,{value:n,className:"mt-4",children:_?e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[1,2,3].map(m=>e.jsx(Se,{className:"h-48"},m))}):ae?.length===0?e.jsxs(k,{className:"p-12 text-center",children:[e.jsx(ne,{className:"h-12 w-12 mx-auto mb-4 text-muted-foreground opacity-50"}),e.jsx("h3",{className:"text-lg font-medium",children:"No applicants found"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:n==="all"?"Invite your first applicant to get started":`No applicants with ${n} status`})]}):e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:ae?.map(m=>e.jsx(ut,{applicant:m,onApprove:()=>ee(m.id),onReject:()=>u(m.id),onStartScreening:()=>S(m.id),onConvert:()=>xe(m),onDelete:()=>{C(m.id),f(!0)}},m.id))})})]})]})]})]}),e.jsx(Ue,{open:b,onOpenChange:f,children:e.jsxs(Le,{children:[e.jsxs(Re,{children:[e.jsx(Ke,{children:"Delete Applicant"}),e.jsx(Ve,{children:"Are you sure you want to delete this applicant? This action cannot be undone."})]}),e.jsxs(Oe,{children:[e.jsx(Qe,{children:"Cancel"}),e.jsx(Be,{onClick:je,className:"bg-red-600 hover:bg-red-700",children:"Delete"})]})]})}),c&&e.jsx(jt,{applicant:c,open:q,onOpenChange:r,onSuccess:()=>{y(null)}})]})}export{Qt as default};
