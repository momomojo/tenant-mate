import{j as e,u as k}from"./vendor-query-BBSsXiBS.js";import{C as g,a as j,b as v,c as w}from"./card-nJjNL--Z.js";import{B as D}from"./badge-COPlmVyV.js";import{c as N,h as u,j as P,s as x,b as f,J as m}from"./index-De75nt2H.js";import{a as h}from"./vendor-react-Cua_SOQ2.js";import{C as A}from"./clock-D6Y4OkTG.js";import{C as F}from"./calendar-DyfbDffr.js";import{D as L}from"./download-CzdIpdYh.js";import{D as R}from"./AppSidebar-BMrVA_Jp.js";const U=N("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);const $=N("Printer",[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]]),S=P("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),y=h.forwardRef(({className:s,variant:t,...a},r)=>e.jsx("div",{ref:r,role:"alert",className:u(S({variant:t}),s),...a}));y.displayName="Alert";const b=h.forwardRef(({className:s,...t},a)=>e.jsx("h5",{ref:a,className:u("mb-1 font-medium leading-none tracking-tight",s),...t}));b.displayName="AlertTitle";const _=h.forwardRef(({className:s,...t},a)=>e.jsx("div",{ref:a,className:u("text-sm [&_p]:leading-relaxed",s),...t}));_.displayName="AlertDescription";function C({amount:s,dueDate:t,propertyId:a}){const{data:r}=k({queryKey:["lateFee",s,t,a],queryFn:async()=>{const{data:i,error:d}=await x.from("payment_configs").select("*").eq("property_id",a).single();if(d)throw d;const{data:c,error:l}=await x.rpc("calculate_late_fee",{payment_amount:s,due_date:t,property_id:a});if(l)throw l;const o=Math.floor((new Date().getTime()-new Date(t).getTime())/(1e3*3600*24));return{lateFee:c,gracePeriod:i?.grace_period_days||5,lateFeePercentage:i?.late_fee_percentage||5,daysLate:o}}});return!r||r.lateFee===0?null:e.jsxs(y,{variant:"destructive",children:[e.jsx(U,{className:"h-4 w-4"}),e.jsx(b,{className:"flex items-center gap-2",children:"Late Payment Fee Applied"}),e.jsxs(_,{className:"mt-2 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(A,{className:"h-4 w-4"}),e.jsxs("span",{children:[r.daysLate," days late (Grace period: ",r.gracePeriod," days)"]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(F,{className:"h-4 w-4"}),e.jsxs("span",{children:["Due date: ",new Date(t).toLocaleDateString()]})]}),e.jsxs("p",{className:"text-sm font-medium mt-2",children:["Late fee (",r.lateFeePercentage,"%): $",r.lateFee]}),e.jsxs("p",{className:"text-sm text-muted",children:["Total amount due: $",(s+r.lateFee).toFixed(2)]})]})]})}function z({payment:s}){const t=async()=>{try{const{data:{session:i}}=await x.auth.getSession();if(!i){m.error("Please log in to download receipt");return}const c=await fetch(`https://xbtuztzcgxhzvsvfcjvk.supabase.co/functions/v1/generate-receipt?paymentId=${s.id}`,{headers:{Authorization:`Bearer ${i.access_token}`}});if(!c.ok)throw new Error("Failed to generate receipt");const l=await c.text(),o=new Blob([l],{type:"text/html"}),p=window.URL.createObjectURL(o),n=document.createElement("a");n.href=p,n.download=`receipt-${s.invoice_number}.html`,document.body.appendChild(n),n.click(),window.URL.revokeObjectURL(p),document.body.removeChild(n),m.success("Receipt downloaded successfully")}catch(i){console.error("Error downloading receipt:",i),m.error("Failed to download receipt")}},a=()=>{window.print()},r=i=>{switch(i.toLowerCase()){case"paid":return"text-green-600";case"pending":return"text-yellow-600";case"failed":return"text-red-600";default:return"text-gray-600"}};return e.jsxs(g,{className:"print:shadow-none",children:[e.jsx(j,{children:e.jsxs(v,{className:"text-sm font-medium",children:["Payment Receipt #",s.invoice_number]})}),e.jsx(w,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Amount"}),e.jsxs("p",{className:"text-lg",children:["$",s.amount]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Date"}),e.jsx("p",{className:"text-lg",children:new Date(s.payment_date).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Unit"}),e.jsx("p",{className:"text-lg",children:s.unit.unit_number})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Status"}),e.jsx("p",{className:`text-lg font-medium ${r(s.status)}`,children:s.status.charAt(0).toUpperCase()+s.status.slice(1)})]})]}),e.jsx(C,{amount:s.amount,dueDate:s.payment_date,propertyId:s.unit.property_id}),e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsxs(f,{variant:"outline",size:"sm",className:"flex-1",onClick:t,children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"Download"]}),e.jsxs(f,{variant:"outline",size:"sm",className:"flex-1 print:hidden",onClick:a,children:[e.jsx($,{className:"h-4 w-4 mr-2"}),"Print"]})]})]})})]})}function O({payments:s}){return e.jsxs(g,{children:[e.jsx(j,{children:e.jsxs(v,{className:"flex items-center gap-2",children:[e.jsx(R,{className:"h-5 w-5"}),"Payment History"]})}),e.jsx(w,{children:e.jsx("div",{className:"space-y-4",children:s.map(t=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between rounded-lg border p-4",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-white",children:["Unit ",t.unit.unit_number]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:new Date(t.payment_date).toLocaleDateString()}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Method: ",t.payment_method||"N/A"]}),t.invoice_number&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Invoice #: ",t.invoice_number]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-lg font-semibold text-white",children:["$",t.amount]}),e.jsx(D,{variant:t.status==="paid"?"default":"secondary",children:t.status})]})]}),e.jsx(C,{amount:t.amount,dueDate:t.payment_date,propertyId:t.unit.property_id}),t.status==="paid"&&e.jsx(z,{payment:{...t,invoice_number:t.invoice_number||0}})]},t.id))})})]})}export{y as A,O as P,_ as a};
