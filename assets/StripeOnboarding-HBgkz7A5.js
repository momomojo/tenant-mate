import{j as r}from"./vendor-query-BBSsXiBS.js";import{a as m,R as z,u as D}from"./vendor-react-Cua_SOQ2.js";import{c as K,u as U,b as v,k as H,s as J}from"./index-De75nt2H.js";import{T as W,a as Y,b as _,c as T}from"./tabs-BX6TOnl4.js";import{C as b,a as w,b as x,d as j,c as O,e as q}from"./card-nJjNL--Z.js";import{E as V}from"./external-link-DNkK3-ok.js";import"./vendor-ui-Dpa_eFEd.js";import"./vendor-supabase-By2EX_dj.js";const B=K("RefreshCcw",[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]]),G={setOnLoadError:e=>{},setOnLoaderStart:e=>{}},R={"account-onboarding":{setFullTermsOfServiceUrl:e=>{},setRecipientTermsOfServiceUrl:e=>{},setPrivacyPolicyUrl:e=>{},setSkipTermsOfServiceCollection:e=>{},setCollectionOptions:e=>{},setOnExit:e=>{},setOnStepChange:e=>{}},"account-management":{setCollectionOptions:e=>{}},"notification-banner":{setCollectionOptions:e=>{},setOnNotificationsChange:e=>{}},"instant-payouts-promotion":{setOnInstantPayoutsPromotionLoaded:e=>{},setOnInstantPayoutCreated:e=>{}},"issuing-card":{setDefaultCard:e=>{},setCardSwitching:e=>{},setFetchEphemeralKey:e=>{},setShowSpendControls:e=>{}},"issuing-cards-list":{setFetchEphemeralKey:e=>{},setShowSpendControls:e=>{},setIssuingProgram:e=>{}},"financial-account":{setFinancialAccount:e=>{}},"financial-account-transactions":{setFinancialAccount:e=>{}},payments:{setDefaultFilters:e=>{}},"payment-details":{setPayment:e=>{},setOnClose:e=>{}},"payment-disputes":{setPayment:e=>{},setOnDisputesLoaded:e=>{}},"tax-settings":{setHideProductTaxCodeSelector:e=>{},setDisplayHeadOfficeCountries:e=>{},setOnTaxSettingsUpdated:e=>{}},"tax-registrations":{setOnAfterTaxRegistrationAdded:e=>{},setDisplayCountries:e=>{},setOnAfterTaxRegistrationExpired:e=>{}},"payout-details":{setPayout:e=>{},setOnClose:e=>{}}},X={"account-onboarding":"stripe-connect-account-onboarding","disputes-list":"stripe-connect-disputes-list",payments:"stripe-connect-payments","payment-details":"stripe-connect-payment-details","payment-disputes":"stripe-connect-payment-disputes",payouts:"stripe-connect-payouts","payouts-list":"stripe-connect-payouts-list","payout-details":"stripe-connect-payout-details",balances:"stripe-connect-balances","account-management":"stripe-connect-account-management","notification-banner":"stripe-connect-notification-banner","instant-payouts-promotion":"stripe-connect-instant-payouts-promotion","issuing-card":"stripe-connect-issuing-card","issuing-cards-list":"stripe-connect-issuing-cards-list","financial-account":"stripe-connect-financial-account","financial-account-transactions":"stripe-connect-financial-account-transactions",documents:"stripe-connect-documents","tax-registrations":"stripe-connect-tax-registrations","tax-settings":"stripe-connect-tax-settings"},I="loadConnect was called but an existing Connect.js script already exists in the document; existing script parameters will be used",Q="https://connect-js.stripe.com/v0.1/connect.js",N="https://connect-js.stripe.com/v1.0/connect.js",Z=()=>document.querySelectorAll(`script[src="${N}"]`)[0]||document.querySelectorAll(`script[src="${Q}"]`)[0]||null,ee=()=>{const e=document.createElement("script");if(e.src=N,!document.head)throw new Error("Expected document.head not to be null. Connect.js requires a <head> element.");return document.head.appendChild(e),e};let g=null;const A=e=>!!(e&&typeof e=="object"&&"init"in e&&typeof e.init=="function"),te=()=>(g!==null||(g=new Promise((e,t)=>{if(typeof window>"u"){t("ConnectJS won't load when rendering code in the server - it can only be loaded on a browser. This error is expected when loading ConnectJS in SSR environments, like NextJS. It will have no impact in the UI, however if you wish to avoid it, you can switch to the `pure` version of the connect.js loader: https://github.com/stripe/connect-js#importing-loadconnect-without-side-effects.");return}if(A(window.StripeConnect)){console.warn(I);const n=P(window.StripeConnect);e(n);return}try{let n=Z();n?console.warn(I):n||(n=ee()),n.addEventListener("load",()=>{if(A(window.StripeConnect)){const i=P(window.StripeConnect);e(i)}else t(new Error("Connect.js did not load the necessary objects"))}),n.addEventListener("error",()=>{t(new Error("Failed to load Connect.js"))})}catch(n){t(n)}})),g),ne=e=>e in R,re=(e,t)=>{var n;const i=(()=>{try{return t.fetchClientSecret()}catch(o){return Promise.reject(o)}})(),a=(n=t.metaOptions)!==null&&n!==void 0?n:{},u=e.then(o=>o.initialize(Object.assign(Object.assign({},t),{metaOptions:Object.assign(Object.assign({},a),{eagerClientSecretPromise:i})})));return{create:o=>{let c=X[o];c||(c=o);const s=document.createElement(c),d=ne(o)?R[o]:{},l=Object.assign(Object.assign({},d),G);for(const y in l)s[y]=function(f){u.then(()=>{if(!this[`${y}InternalOnly`])throw new Error(`Method ${y} is not available in the ${o} HTML element. Are you using a supported version of the "@stripe/connect-js" package? Using version: 3.3.31`);this[`${y}InternalOnly`](f)})};return u.then(y=>{if(!s.isConnected&&!s.setConnector){const f=s.style.display;s.style.display="none",document.body.appendChild(s),document.body.removeChild(s),s.style.display=f}if(!s||!s.setConnector)throw new Error(`Element ${o} was not transformed into a custom element. Are you using a documented component? See https://docs.stripe.com/connect/supported-embedded-components for a list of supported components`);s.setConnector(y.connect)}),s},update:o=>{u.then(c=>{c.update(o)})},debugInstance:()=>u,logout:()=>u.then(o=>o.logout())}},P=e=>(window.StripeConnect=window.StripeConnect||{},window.StripeConnect.optimizedLoading=!0,{initialize:n=>{var i;const a=(i=n.metaOptions)!==null&&i!==void 0?i:{};return e.init(Object.assign(Object.assign({},n),{metaOptions:Object.assign(Object.assign({},a),{sdk:!0,sdkOptions:{sdkVersion:"3.3.31"}})}))}}),F=Promise.resolve().then(()=>te());let M=!1;F.catch(e=>{M||console.warn(e)});const $=e=>(M=!0,re(F,e)),oe=()=>{const[e,t]=m.useState(null),[n,i]=m.useState(!0),[a,u]=m.useState(null),o=m.useCallback(async()=>{try{i(!0);const c="pk_test_your_publishable_key",s=$({publishableKey:c,fetchClientSecret:async()=>{const d=await fetch("/api/account-session"),{clientSecret:l}=await d.json();return l},appearance:{overlays:"dialog",variables:{colorPrimary:"#6366f1"}}});t(s)}catch(c){console.error("Error initializing Stripe Connect:",c),u(c instanceof Error?c:new Error("Unknown error"))}finally{i(!1)}},[]);return m.useEffect(()=>{o()},[o]),{stripeConnect:e,isLoading:n,error:a,reload:o}};function se(e,t){var n=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(n!=null){var i,a,u,o,c=[],s=!0,d=!1;try{if(u=(n=n.call(e)).next,t!==0)for(;!(s=(i=u.call(n)).done)&&(c.push(i.value),c.length!==t);s=!0);}catch(l){d=!0,a=l}finally{try{if(!s&&n.return!=null&&(o=n.return(),Object(o)!==o))return}finally{if(d)throw a}}return c}}function ie(e,t){return ce(e)||se(e,t)||ae(e,t)||le()}function ce(e){if(Array.isArray(e))return e}function ae(e,t){if(e){if(typeof e=="string")return k(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return k(e,t)}}function k(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function le(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var E=m.createContext(null);E.displayName="ConnectComponents";var ue=function(t){var n=t.connectInstance,i=t.children;return m.createElement(E.Provider,{value:{connectInstance:n}},i)},de=function(){var t=m.useContext(E);if(!t)throw new Error("Could not find Components context; You need to wrap the part of your app in an <ConnectComponentsProvider> provider.");return t},pe=function(t){var n=m.useState(null),i=ie(n,2),a=i[0],u=i[1],o=de(),c=o.connectInstance,s=m.useRef(null),d=m.createElement("div",{style:{width:"100%"},"data-stripe-connect-js-wrapper":!0,ref:s});return m.useLayoutEffect(function(){if(s.current!==null&&a===null){var l=c.create(t);if(u(l),l!==null){try{l.setAttribute("reactSdkAnalytics","3.3.31")}catch(y){console.log("Error setting React Sdk version with error message: ",y)}for(;s.current.firstChild;)s.current.removeChild(s.current.firstChild);s.current.appendChild(l)}}},[c,t]),{wrapper:d,component:a}},S=function(t,n,i){z.useEffect(function(){if(t)try{i(t,n)}catch(a){console.error("Error when calling setter! ",a);return}},[t,n,i])},he=function(t){var n=t.onExit,i=t.recipientTermsOfServiceUrl,a=t.fullTermsOfServiceUrl,u=t.privacyPolicyUrl,o=t.skipTermsOfServiceCollection,c=t.collectionOptions,s=t.onLoadError,d=t.onLoaderStart,l=t.onStepChange,y=pe("account-onboarding"),f=y.wrapper,C=y.component;return S(C,i,function(p,h){return p.setRecipientTermsOfServiceUrl(h)}),S(C,a,function(p,h){return p.setFullTermsOfServiceUrl(h)}),S(C,u,function(p,h){return p.setPrivacyPolicyUrl(h)}),S(C,o,function(p,h){return p.setSkipTermsOfServiceCollection(h)}),S(C,c,function(p,h){return p.setCollectionOptions(h)}),S(C,n,function(p,h){return p.setOnExit(h)}),S(C,d,function(p,h){p.setOnLoaderStart(h)}),S(C,s,function(p,h){p.setOnLoadError(h)}),S(C,l,function(p,h){return p.setOnStepChange(h)}),f},L;(function(e){e.exit="exit",e.close="close",e.instantPayoutCreated="instantpayoutcreated"})(L||(L={}));const me=({accountId:e,onboardingComplete:t})=>{const[n,i]=m.useState(null),[a,u]=m.useState(!1),{toast:o}=U(),c=async()=>{u(!0);try{const d="pk_test_your_publishable_key",l=$({publishableKey:d,fetchClientSecret:async()=>{const f=await(await fetch("/api/create-account-session",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({accountId:e})})).json();if(f.success&&f.clientSecret)return f.clientSecret;throw new Error(f.error||"Failed to create account session")},appearance:{overlays:"dialog",variables:{colorPrimary:"#6366f1"}}});i(l)}catch(d){console.error("Error initializing Stripe Connect:",d),o({variant:"destructive",title:"Error",description:"Failed to connect your Stripe account. Please try again."})}finally{u(!1)}},s=()=>{o({title:"Onboarding Complete",description:"Your Stripe account is now connected!"}),t&&t()};return r.jsxs(b,{children:[r.jsxs(w,{children:[r.jsx(x,{children:"Connect your Stripe account"}),r.jsx(j,{children:"Set up your payment processing to receive payments directly to your bank account."})]}),r.jsx(O,{children:n?r.jsx(ue,{connectInstance:n,children:r.jsx(he,{onExit:s})}):r.jsx("p",{children:"Click the button below to start the Stripe onboarding process."})}),r.jsx(q,{children:!n&&r.jsx(v,{onClick:c,disabled:a,children:a?"Loading...":"Start Onboarding"})})]})},xe=()=>{const e=D(),[t,n]=m.useState(null),{isLoading:i,error:a,reload:u}=oe(),{toast:o}=U();m.useEffect(()=>{(async()=>{const{data:{session:l}}=await J.auth.getSession();l||e("/auth")})()},[e]);const c=async()=>{try{const l=await(await fetch("/api/create-connected-account",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:"user@example.com"})})).json();if(l.success&&l.accountId)n(l.accountId),o({title:"Account Created",description:"Your Stripe connected account has been created. Continue to onboarding."});else throw new Error(l.error||"Failed to create connected account")}catch(d){console.error("Error creating connected account:",d),o({variant:"destructive",title:"Error",description:"Failed to create Stripe account. Please try again."})}},s=()=>{o({title:"Success",description:"Your Stripe account is now fully set up and ready to process payments!"})};return r.jsxs("div",{className:"container mx-auto px-4 py-6 sm:py-10",children:[r.jsx("h1",{className:"text-2xl sm:text-3xl font-bold mb-4 sm:mb-6",children:"Stripe Integration"}),r.jsxs(W,{defaultValue:"account",className:"w-full",children:[r.jsxs(Y,{className:"mb-4",children:[r.jsx(_,{value:"account",children:"Account Setup"}),r.jsx(_,{value:"payments",children:"Payment Processing"})]}),r.jsx(T,{value:"account",children:r.jsxs(b,{children:[r.jsxs(w,{children:[r.jsx(x,{children:"Connect with Stripe"}),r.jsx(j,{children:"Set up your Stripe account to receive payments directly to your bank account."})]}),r.jsxs(O,{className:"space-y-4",children:[a&&r.jsxs("div",{className:"p-4 bg-destructive/10 text-destructive rounded-md mb-4",children:[r.jsxs("p",{children:["Error initializing Stripe: ",a.message]}),r.jsxs(v,{variant:"outline",size:"sm",className:"mt-2",onClick:u,children:[r.jsx(B,{className:"mr-2 h-4 w-4"})," Retry"]})]}),i?r.jsx("p",{children:"Loading Stripe integration..."}):r.jsxs("div",{className:"space-y-6",children:[t?r.jsx(me,{accountId:t,onboardingComplete:s}):r.jsxs("div",{children:[r.jsx("p",{className:"mb-4",children:"To receive payments, you'll need to connect a Stripe account. This allows you to get paid directly to your bank account."}),r.jsxs(v,{onClick:c,children:["Create Stripe Account ",r.jsx(H,{className:"ml-2 h-4 w-4"})]})]}),r.jsx("div",{className:"text-xs text-muted-foreground",children:r.jsxs("p",{children:["By connecting with Stripe, you agree to their"," ",r.jsxs("a",{href:"https://stripe.com/legal/connect-account",target:"_blank",rel:"noopener noreferrer",className:"underline",children:["Terms of Service ",r.jsx(V,{className:"inline h-3 w-3"})]})]})})]})]})]})}),r.jsx(T,{value:"payments",children:r.jsxs(b,{children:[r.jsxs(w,{children:[r.jsx(x,{children:"Payment Processing"}),r.jsx(j,{children:"Manage your payment settings and view transaction history."})]}),r.jsx(O,{children:r.jsx("p",{children:"You'll be able to manage payment settings and view transaction history once your Stripe account is fully set up."})})]})})]})]})};export{xe as default};
