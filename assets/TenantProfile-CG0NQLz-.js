import{j as e,b as C,u as A,c as p}from"./vendor-query-BBSsXiBS.js";import{j as T,u as E,a as q}from"./vendor-react-Cua_SOQ2.js";import{c as k,b as j,J as c,s as l,W as H}from"./index-De75nt2H.js";import{d as M,S as y,A as g}from"./AppSidebar-BMrVA_Jp.js";import{C as v,a as _,b as N,c as w}from"./card-nJjNL--Z.js";import{A as S,a as F}from"./avatar-BzXIJ7c5.js";import{M as R}from"./mail-DsNYd1qp.js";import{B as h}from"./badge-COPlmVyV.js";import{T as K,a as Q,b,c as L}from"./tabs-BX6TOnl4.js";import{A as P,h as z,a as B,b as U,c as J,d as W,e as $,f as V,g as G,T as O}from"./alert-dialog-CYp6Xfqu.js";import{C as X}from"./calendar-DyfbDffr.js";import{R as Y}from"./refresh-cw-obccOSpX.js";import{P as Z}from"./PaymentHistory-TKtHj9sV.js";import"./vendor-ui-Dpa_eFEd.js";import"./vendor-supabase-By2EX_dj.js";import"./useAuthenticatedUser-DxFjEeTf.js";import"./clock-D6Y4OkTG.js";import"./download-CzdIpdYh.js";const I=k("ArchiveRestore",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h2",key:"tvwodi"}],["path",{d:"M20 8v11a2 2 0 0 1-2 2h-2",key:"1gkqxj"}],["path",{d:"m9 15 3-3 3 3",key:"1pd0qc"}],["path",{d:"M12 12v9",key:"192myk"}]]);const ee=k("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);function se({tenant:a}){const t=`${a.first_name?.[0]||""}${a.last_name?.[0]||""}`,i=[a.first_name,a.last_name].filter(Boolean).join(" ");return e.jsxs(v,{children:[e.jsx(_,{children:e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-5 w-5"}),"Tenant Information"]})}),e.jsxs(w,{className:"flex items-start space-x-4",children:[e.jsx(S,{className:"h-20 w-20",children:e.jsx(F,{className:"text-xl bg-primary text-primary-foreground",children:t})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-2xl font-semibold text-white",children:i}),e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(R,{className:"h-4 w-4"}),e.jsx("span",{children:a.email})]})})]})]})]})}function te({leases:a,tenantId:t}){const i=C(),{data:f,isLoading:o}=A({queryKey:["deletedLeases",t],queryFn:async()=>{const{data:s,error:n}=await l.from("deleted_tenant_units").select(`
          id,
          unit_id,
          lease_start_date,
          lease_end_date,
          status,
          deleted_at,
          deleted_by (
            first_name,
            last_name
          ),
          unit:units (
            unit_number,
            property:properties (
              name
            )
          )
        `).eq("tenant_id",t).order("deleted_at",{ascending:!1});if(n)throw n;return s}}),d=p({mutationFn:async s=>{const{error:n}=await l.from("tenant_units").insert({tenant_id:t,unit_id:s.unit_id,lease_start_date:s.lease_start_date,lease_end_date:s.lease_end_date,status:s.status});if(n)throw n;const{error:r}=await l.from("deleted_tenant_units").delete().eq("id",s.id);if(r)throw r},onSuccess:()=>{c.success("Lease restored successfully"),i.invalidateQueries({queryKey:["deletedLeases",t]}),i.invalidateQueries({queryKey:["tenant",t]})},onError:s=>{console.error("Error restoring lease:",s),c.error("Failed to restore lease")}}),m=p({mutationFn:async s=>{const{error:n}=await l.from("tenant_units").delete().eq("id",s);if(n)throw n},onSuccess:()=>{c.success("Lease deleted successfully"),i.invalidateQueries({queryKey:["tenant",t]}),i.invalidateQueries({queryKey:["deletedLeases",t]})},onError:s=>{console.error("Error deleting lease:",s),c.error("Failed to delete lease")}}),u=p({mutationFn:async()=>{const{error:s}=await l.rpc("reset_tenant_lease_history",{tenant_id_param:t});if(s)throw s},onSuccess:()=>{c.success("Lease history reset successfully"),i.invalidateQueries({queryKey:["tenant",t]}),i.invalidateQueries({queryKey:["deletedLeases",t]})},onError:s=>{console.error("Error resetting lease history:",s),c.error("Failed to reset lease history")}}),x=(s,n=!1)=>!s||s.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:["No ",n?"deleted":"active"," lease records found"]}):e.jsx("div",{className:"relative space-y-6",children:s.map((r,D)=>e.jsxs("div",{className:"flex items-start gap-4 pb-6 last:pb-0",children:[D<s.length-1&&e.jsx("div",{className:"absolute left-2 top-8 bottom-0 w-0.5 bg-border"}),e.jsx("div",{className:"relative z-10 mt-1 rounded-full bg-background p-1 ring-2 ring-border",children:e.jsx("div",{className:"h-2 w-2 rounded-full bg-primary"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h4",{className:"text-lg font-medium text-white",children:[r.unit.property.name," - Unit ",r.unit.unit_number]}),e.jsxs("p",{className:"mt-1 text-sm text-muted-foreground",children:[new Date(r.lease_start_date).toLocaleDateString()," -"," ",new Date(r.lease_end_date).toLocaleDateString()]}),e.jsxs("div",{className:"mt-2 flex flex-wrap gap-2",children:[e.jsx(h,{variant:r.status==="active"?"default":"secondary",children:r.status}),n?e.jsxs(e.Fragment,{children:[e.jsx(h,{variant:"destructive",children:"Deleted"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Deleted by: ",r.deleted_by.first_name," ",r.deleted_by.last_name," on"," ",new Date(r.deleted_at).toLocaleDateString()]}),e.jsxs(j,{variant:"outline",size:"sm",className:"mt-2",onClick:()=>d.mutate(r),disabled:d.isPending,children:[e.jsx(I,{className:"mr-2 h-4 w-4"}),"Restore Lease"]})]}):e.jsxs(j,{variant:"destructive",size:"sm",className:"mt-2",onClick:()=>m.mutate(r.id),disabled:m.isPending,children:[e.jsx(O,{className:"mr-2 h-4 w-4"}),"Delete Lease"]})]})]})]},r.id))});return e.jsxs(v,{children:[e.jsx(_,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(X,{className:"h-5 w-5"}),"Lease History"]}),e.jsxs(P,{children:[e.jsx(z,{asChild:!0,children:e.jsxs(j,{variant:"destructive",size:"sm",children:[e.jsx(Y,{className:"mr-2 h-4 w-4"}),"Reset History"]})}),e.jsxs(B,{children:[e.jsxs(U,{children:[e.jsx(J,{children:"Reset Lease History"}),e.jsx(W,{children:"This action will permanently delete all lease history for this tenant, including both active and deleted leases. This action cannot be undone."})]}),e.jsxs($,{children:[e.jsx(V,{children:"Cancel"}),e.jsx(G,{onClick:()=>u.mutate(),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Reset History"})]})]})]})]})}),e.jsx(w,{children:e.jsxs(K,{defaultValue:"active",className:"w-full",children:[e.jsxs(Q,{className:"w-full",children:[e.jsx(b,{value:"active",className:"flex-1",children:"Active History"}),e.jsxs(b,{value:"deleted",className:"flex-1",children:[e.jsx(ee,{className:"mr-2 h-4 w-4"}),"Deleted History"]})]}),e.jsx(L,{value:"active",children:x(a)}),e.jsx(L,{value:"deleted",children:o?e.jsx("p",{className:"text-center text-muted-foreground",children:"Loading deleted leases..."}):x(f,!0)})]})})]})}function ae({requests:a}){return e.jsxs(v,{children:[e.jsx(_,{children:e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(H,{className:"h-5 w-5"}),"Maintenance History"]})}),e.jsx(w,{children:e.jsx("div",{className:"space-y-4",children:a.map(t=>e.jsxs("div",{className:"rounded-lg border p-4 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"font-medium text-white",children:t.title}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(h,{variant:"outline",children:t.priority}),e.jsx(h,{variant:t.status==="completed"?"default":"secondary",children:t.status})]})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Unit ",t.unit.unit_number]}),e.jsx("p",{className:"text-sm text-gray-300",children:t.description}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Submitted on"," ",new Date(t.created_at).toLocaleDateString()]})]},t.id))})})]})}const Ne=()=>{const{id:a}=T(),t=E();q.useEffect(()=>{(async()=>{const{data:{session:d}}=await l.auth.getSession();d||t("/auth")})()},[t]);const{data:i,isLoading:f}=A({queryKey:["tenant",a],queryFn:async()=>{if(!a)throw new Error("No tenant ID provided");const{data:o,error:d}=await l.from("profiles").select("*").eq("id",a).single();if(d)throw d;const{data:m,error:u}=await l.from("tenant_units").select(`
          *,
          unit:units (
            unit_number,
            property:properties (
              name
            )
          )
        `).eq("tenant_id",a).order("lease_start_date",{ascending:!1});if(u)throw u;const{data:x,error:s}=await l.from("rent_payments").select(`
          *,
          unit:units (
            unit_number,
            property_id
          )
        `).eq("tenant_id",a).order("payment_date",{ascending:!1});if(s)throw s;const{data:n,error:r}=await l.from("maintenance_requests").select(`
          *,
          unit:units (
            unit_number
          )
        `).eq("tenant_id",a).order("created_at",{ascending:!1});if(r)throw r;return{profile:o,leases:m,payments:x,maintenance:n}},enabled:!!a});return f?e.jsx(y,{children:e.jsxs("div",{className:"flex min-h-screen w-full bg-background",children:[e.jsx(g,{}),e.jsx("main",{className:"flex-1 p-8",children:e.jsx("div",{className:"text-center text-gray-400",children:"Loading tenant data..."})})]})}):i?e.jsx(y,{children:e.jsxs("div",{className:"flex min-h-screen w-full bg-background",children:[e.jsx(g,{}),e.jsx("main",{className:"flex-1 p-4 sm:p-8",children:e.jsxs("div",{className:"mx-auto max-w-5xl space-y-4 sm:space-y-6",children:[e.jsx(se,{tenant:i.profile}),e.jsx(te,{leases:i.leases,tenantId:a}),e.jsx(Z,{payments:i.payments}),e.jsx(ae,{requests:i.maintenance})]})})]})}):e.jsx(y,{children:e.jsxs("div",{className:"flex min-h-screen w-full bg-background",children:[e.jsx(g,{}),e.jsx("main",{className:"flex-1 p-8",children:e.jsx("div",{className:"text-center text-gray-400",children:"Tenant not found"})})]})})};export{Ne as default};
