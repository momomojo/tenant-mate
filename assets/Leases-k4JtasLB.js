import{u as ee,b as te,c as se,j as e}from"./vendor-query-BBSsXiBS.js";import{a as g,u as Le}from"./vendor-react-Cua_SOQ2.js";import{c as qe,s as _,B as Me,b as F,S as k,d as P,e as R,f as U,g as S,u as fe,a as Ee,F as Ae,p as y,q as v,r as p,t as N,v as D,w as ke,I as C,x as Pe,z as f}from"./index-De75nt2H.js";import{u as ne,S as Re}from"./useAuthenticatedUser-DxFjEeTf.js";import{F as J,d as Ue,D as Ve,S as Oe,A as $e}from"./AppSidebar-BMrVA_Jp.js";import{T as Ye}from"./TopBar-ioa75gCp.js";import{C as L,a as M,b as E,c as A}from"./card-nJjNL--Z.js";import{B as W}from"./badge-COPlmVyV.js";import{D as ze,a as Be,E as He,b as Ke,c as I,d as ie}from"./dropdown-menu-ADG-5tNT.js";import{t as X,d as Qe,p as ge,q as ye,f as Y}from"./format-BJjq1L2l.js";import{S as ae,u as ve}from"./useProperties-CW1cgYmm.js";import{S as Ze}from"./send-BsAD5O5v.js";import{C as H}from"./circle-check-big-Cj9dHWRz.js";import{R as Ne}from"./refresh-cw-obccOSpX.js";import{C as K}from"./circle-x-Dmf2Egdb.js";import{T as We,A as le,a as oe,b as ce,c as de,d as ue,e as me,f as xe,g as he}from"./alert-dialog-CYp6Xfqu.js";import{C as Ge}from"./calendar-DyfbDffr.js";import{C as De}from"./clock-D6Y4OkTG.js";import{u as Je}from"./useUnits-BY5QSTqu.js";import{D as Xe,a as et,b as tt,c as st,d as nt}from"./dialog-CU0zoF6x.js";import{P as at}from"./plus-CuU8l0SB.js";import{L as rt}from"./loader-circle-CxRwcVV4.js";import{b as it,a as lt}from"./addYears-CGq75uKQ.js";import{T as ot,a as ct,b as O,c as dt}from"./tabs-BX6TOnl4.js";import"./vendor-ui-Dpa_eFEd.js";import"./vendor-supabase-By2EX_dj.js";import"./scroll-area-DovF1kS9.js";import"./chevron-right-BxT_eo_W.js";import"./circle-C417sgD2.js";const ut=qe("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);function mt(s,t){const n=X(s),a=X(t),i=pe(n,a),o=Math.abs(Qe(n,a));n.setDate(n.getDate()-i*o);const d=+(pe(n,a)===-i),h=i*(o-d);return h===0?0:h}function pe(s,t){const n=s.getFullYear()-t.getFullYear()||s.getMonth()-t.getMonth()||s.getDate()-t.getDate()||s.getHours()-t.getHours()||s.getMinutes()-t.getMinutes()||s.getSeconds()-t.getSeconds()||s.getMilliseconds()-t.getMilliseconds();return n<0?-1:n>0?1:n}function xt(s){return+X(s)<Date.now()}function je(s,t){const a=ft(s);let i;if(a.date){const m=gt(a.date,2);i=yt(m.restDateString,m.year)}if(!i||isNaN(i.getTime()))return new Date(NaN);const o=i.getTime();let d=0,h;if(a.time&&(d=vt(a.time),isNaN(d)))return new Date(NaN);if(a.timezone){if(h=Nt(a.timezone),isNaN(h))return new Date(NaN)}else{const m=new Date(o+d),x=new Date(0);return x.setFullYear(m.getUTCFullYear(),m.getUTCMonth(),m.getUTCDate()),x.setHours(m.getUTCHours(),m.getUTCMinutes(),m.getUTCSeconds(),m.getUTCMilliseconds()),x}return new Date(o+d+h)}const B={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},ht=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,pt=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,jt=/^([+-])(\d{2})(?::?(\d{2}))?$/;function ft(s){const t={},n=s.split(B.dateTimeDelimiter);let a;if(n.length>2)return t;if(/:/.test(n[0])?a=n[0]:(t.date=n[0],a=n[1],B.timeZoneDelimiter.test(t.date)&&(t.date=s.split(B.timeZoneDelimiter)[0],a=s.substr(t.date.length,s.length))),a){const i=B.timezone.exec(a);i?(t.time=a.replace(i[1],""),t.timezone=i[1]):t.time=a}return t}function gt(s,t){const n=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+t)+"})|(\\d{2}|[+-]\\d{"+(2+t)+"})$)"),a=s.match(n);if(!a)return{year:NaN,restDateString:""};const i=a[1]?parseInt(a[1]):null,o=a[2]?parseInt(a[2]):null;return{year:o===null?i:o*100,restDateString:s.slice((a[1]||a[2]).length)}}function yt(s,t){if(t===null)return new Date(NaN);const n=s.match(ht);if(!n)return new Date(NaN);const a=!!n[4],i=$(n[1]),o=$(n[2])-1,d=$(n[3]),h=$(n[4]),m=$(n[5])-1;if(a)return St(t,h,m)?Dt(t,h,m):new Date(NaN);{const x=new Date(0);return!bt(t,o,d)||!Ct(t,i)?new Date(NaN):(x.setUTCFullYear(t,o,Math.max(i,d)),x)}}function $(s){return s?parseInt(s):1}function vt(s){const t=s.match(pt);if(!t)return NaN;const n=G(t[1]),a=G(t[2]),i=G(t[3]);return _t(n,a,i)?n*ge+a*ye+i*1e3:NaN}function G(s){return s&&parseFloat(s.replace(",","."))||0}function Nt(s){if(s==="Z")return 0;const t=s.match(jt);if(!t)return 0;const n=t[1]==="+"?-1:1,a=parseInt(t[2]),i=t[3]&&parseInt(t[3])||0;return Tt(a,i)?n*(a*ge+i*ye):NaN}function Dt(s,t,n){const a=new Date(0);a.setUTCFullYear(s,0,4);const i=a.getUTCDay()||7,o=(t-1)*7+n+1-i;return a.setUTCDate(a.getUTCDate()+o),a}const wt=[31,null,31,30,31,30,31,31,30,31,30,31];function we(s){return s%400===0||s%4===0&&s%100!==0}function bt(s,t,n){return t>=0&&t<=11&&n>=1&&n<=(wt[t]||(we(s)?29:28))}function Ct(s,t){return t>=1&&t<=(we(s)?366:365)}function St(s,t,n){return t>=1&&t<=53&&n>=0&&n<=6}function _t(s,t,n){return s===24?t===0&&n===0:n>=0&&n<60&&t>=0&&t<60&&s>=0&&s<25}function Tt(s,t){return t>=0&&t<=59}function It(s={}){const{user:t}=ne();return ee({queryKey:["leases",t?.id,s],queryFn:async()=>{if(!t)return[];let n=_.from("leases").select(`
          *,
          property:properties!inner(id, name, address, created_by, property_manager_id),
          unit:units(id, unit_number),
          tenant:profiles!leases_tenant_id_fkey(id, first_name, last_name, email)
        `).or(`property.created_by.eq.${t.id},property.property_manager_id.eq.${t.id}`).order("created_at",{ascending:!1});s.propertyId&&(n=n.eq("property_id",s.propertyId)),s.tenantId&&(n=n.eq("tenant_id",s.tenantId)),s.status&&(n=n.eq("status",s.status));const{data:a,error:i}=await n;if(i)throw i;return a},enabled:!!t})}function Ft(){return ee({queryKey:["lease-templates"],queryFn:async()=>{const{data:s,error:t}=await _.from("lease_templates").select("*").eq("is_active",!0).order("is_default",{ascending:!1});if(t)throw t;return s}})}function Lt(){const s=te(),{user:t}=ne();return se({mutationFn:async n=>{if(!t)throw new Error("Not authenticated");const{data:a,error:i}=await _.from("leases").insert({property_id:n.propertyId,unit_id:n.unitId,tenant_id:n.tenantId,template_id:n.templateId||null,lease_start:n.leaseStart,lease_end:n.leaseEnd,monthly_rent:n.monthlyRent,security_deposit:n.securityDeposit||0,late_fee:n.lateFee||50,grace_period_days:n.gracePeriodDays||5,pet_deposit:n.petDeposit||0,pet_rent:n.petRent||0,status:"draft",created_by:t.id}).select(`
          *,
          property:properties(id, name, address),
          unit:units(id, unit_number),
          tenant:profiles!leases_tenant_id_fkey(id, first_name, last_name, email)
        `).single();if(i)throw i;return a},onSuccess:()=>{s.invalidateQueries({queryKey:["leases"]})}})}function qt(){const s=te();return se({mutationFn:async t=>{const n={};t.status&&(n.status=t.status),t.content!==void 0&&(n.content=t.content),t.signatureStatus&&(n.signature_status=t.signatureStatus),t.signatureProvider&&(n.signature_provider=t.signatureProvider),t.signatureRequestId&&(n.signature_request_id=t.signatureRequestId);const{data:a,error:i}=await _.from("leases").update(n).eq("id",t.leaseId).select(`
          *,
          property:properties(id, name, address),
          unit:units(id, unit_number),
          tenant:profiles!leases_tenant_id_fkey(id, first_name, last_name, email)
        `).single();if(i)throw i;return a},onSuccess:(t,n)=>{s.invalidateQueries({queryKey:["leases"]}),s.invalidateQueries({queryKey:["lease",n.leaseId]})}})}function Mt(){const s=te();return se({mutationFn:async t=>{const{error:n}=await _.from("leases").delete().eq("id",t);if(n)throw n},onSuccess:()=>{s.invalidateQueries({queryKey:["leases"]})}})}function Et(s){const{user:t}=ne();return ee({queryKey:["lease-counts",t?.id,s],queryFn:async()=>{if(!t)return{};let n=_.from("leases").select(`
          status,
          property:properties!inner(created_by, property_manager_id)
        `).or(`property.created_by.eq.${t.id},property.property_manager_id.eq.${t.id}`);s&&(n=n.eq("property_id",s));const{data:a,error:i}=await n;if(i)return{};const o={total:0,draft:0,pending:0,signed:0,active:0,expired:0,terminated:0};return(a||[]).forEach(d=>{o.total++,o[d.status]!==void 0&&o[d.status]++}),o},enabled:!!t})}const At={draft:{label:"Draft",variant:"secondary",icon:e.jsx(ae,{className:"h-3 w-3"})},pending:{label:"Pending Signature",variant:"outline",icon:e.jsx(De,{className:"h-3 w-3"})},signed:{label:"Signed",variant:"default",icon:e.jsx(H,{className:"h-3 w-3"})},active:{label:"Active",variant:"default",icon:e.jsx(H,{className:"h-3 w-3"})},expired:{label:"Expired",variant:"destructive",icon:e.jsx(K,{className:"h-3 w-3"})},terminated:{label:"Terminated",variant:"destructive",icon:e.jsx(K,{className:"h-3 w-3"})},renewed:{label:"Renewed",variant:"default",icon:e.jsx(Ne,{className:"h-3 w-3"})}};function kt({lease:s,onView:t,onEdit:n,onSendForSignature:a,onActivate:i,onTerminate:o,onRenew:d,onDelete:h}){const m=At[s.status],x=je(s.lease_end),w=mt(x,new Date),c=w<=30&&w>0,q=xt(x),j=s.tenant?`${s.tenant.first_name||""} ${s.tenant.last_name||""}`.trim()||s.tenant.email:"Unknown Tenant";return e.jsxs(L,{className:"hover:shadow-md transition-shadow",children:[e.jsx(M,{className:"pb-2",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(E,{className:"text-lg flex items-center gap-2",children:[e.jsx(J,{className:"h-4 w-4"}),"Lease Agreement"]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(Me,{className:"h-3 w-3"}),e.jsx("span",{children:s.property?.name}),s.unit&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"-"}),e.jsxs("span",{children:["Unit ",s.unit.unit_number]})]})]})]}),e.jsxs(ze,{children:[e.jsx(Be,{asChild:!0,children:e.jsx(F,{variant:"ghost",size:"icon",className:"h-8 w-8",children:e.jsx(He,{className:"h-4 w-4"})})}),e.jsxs(Ke,{align:"end",children:[e.jsxs(I,{onClick:t,children:[e.jsx(ut,{className:"h-4 w-4 mr-2"}),"View Details"]}),s.status==="draft"&&e.jsxs(e.Fragment,{children:[e.jsxs(I,{onClick:n,children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),"Edit"]}),e.jsxs(I,{onClick:a,children:[e.jsx(Ze,{className:"h-4 w-4 mr-2"}),"Send for Signature"]})]}),s.status==="signed"&&e.jsxs(I,{onClick:i,children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),"Activate Lease"]}),s.status==="active"&&e.jsxs(e.Fragment,{children:[e.jsxs(I,{onClick:d,children:[e.jsx(Ne,{className:"h-4 w-4 mr-2"}),"Renew Lease"]}),e.jsx(ie,{}),e.jsxs(I,{onClick:o,className:"text-red-600",children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),"Terminate"]})]}),s.status==="draft"&&e.jsxs(e.Fragment,{children:[e.jsx(ie,{}),e.jsxs(I,{onClick:h,className:"text-red-600",children:[e.jsx(We,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]})]})]})}),e.jsxs(A,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Ue,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:j})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Ge,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{children:[Y(je(s.lease_start),"MMM d, yyyy")," -"," ",Y(x,"MMM d, yyyy")]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Ve,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{className:"font-medium",children:["$",s.monthly_rent.toLocaleString(),"/month"]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t",children:[e.jsxs(W,{variant:m.variant,className:"flex items-center gap-1",children:[m.icon,m.label]}),s.status==="active"&&e.jsx(e.Fragment,{children:q?e.jsx(W,{variant:"destructive",className:"text-xs",children:"Expired"}):c?e.jsxs(W,{variant:"outline",className:"text-xs text-orange-600 border-orange-600",children:["Expires in ",w," days"]}):null})]})]})]})}const Pt=[{value:"",label:"All Statuses"},{value:"draft",label:"Draft"},{value:"pending",label:"Pending Signature"},{value:"signed",label:"Signed"},{value:"active",label:"Active"},{value:"expired",label:"Expired"},{value:"terminated",label:"Terminated"},{value:"renewed",label:"Renewed"}];function Rt({propertyId:s,onPropertyChange:t,status:n,onStatusChange:a}){const{data:i}=ve();return e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs(k,{value:s,onValueChange:t,children:[e.jsx(P,{className:"w-full sm:w-[200px]",children:e.jsx(R,{placeholder:"All Properties"})}),e.jsxs(U,{children:[e.jsx(S,{value:"",children:"All Properties"}),i?.map(o=>e.jsx(S,{value:o.id,children:o.name},o.id))]})]}),e.jsxs(k,{value:n,onValueChange:a,children:[e.jsx(P,{className:"w-full sm:w-[180px]",children:e.jsx(R,{placeholder:"All Statuses"})}),e.jsx(U,{children:Pt.map(o=>e.jsx(S,{value:o.value,children:o.label},o.value))})]})]})}const Ut=f.object({propertyId:f.string().min(1,"Property is required"),unitId:f.string().min(1,"Unit is required"),tenantId:f.string().min(1,"Tenant is required"),templateId:f.string().optional(),leaseStart:f.string().min(1,"Start date is required"),leaseEnd:f.string().min(1,"End date is required"),monthlyRent:f.coerce.number().min(1,"Monthly rent is required"),securityDeposit:f.coerce.number().min(0).optional(),lateFee:f.coerce.number().min(0).optional(),gracePeriodDays:f.coerce.number().min(0).optional(),petDeposit:f.coerce.number().min(0).optional(),petRent:f.coerce.number().min(0).optional()});function Vt(){const[s,t]=g.useState(!1),[n,a]=g.useState([]),[i,o]=g.useState(!1),{toast:d}=fe(),{data:h}=ve(),{data:m}=Ft(),{mutateAsync:x,isPending:w}=Lt(),c=Ee({resolver:Pe(Ut),defaultValues:{propertyId:"",unitId:"",tenantId:"",templateId:"",leaseStart:Y(new Date,"yyyy-MM-dd"),leaseEnd:Y(it(new Date,1),"yyyy-MM-dd"),monthlyRent:0,securityDeposit:0,lateFee:50,gracePeriodDays:5,petDeposit:0,petRent:0}}),q=c.watch("propertyId"),j=c.watch("unitId"),{data:T}=Je(q||void 0);g.useEffect(()=>{async function r(){if(!j){a([]);return}o(!0);try{const{data:l,error:b}=await _.from("tenant_units").select(`
            tenant:profiles!tenant_units_tenant_id_fkey(id, first_name, last_name, email)
          `).eq("unit_id",j).eq("status","active");if(b)throw b;const Q=l?.map(Z=>Z.tenant).filter(Boolean);a(Q||[])}catch(l){console.error("Error loading tenants:",l)}finally{o(!1)}}r()},[j]),g.useEffect(()=>{if(j&&T){const r=T.find(l=>l.id===j);r?.rent_amount&&c.setValue("monthlyRent",r.rent_amount)}},[j,T,c]);const z=async r=>{try{await x({propertyId:r.propertyId,unitId:r.unitId,tenantId:r.tenantId,templateId:r.templateId||void 0,leaseStart:r.leaseStart,leaseEnd:r.leaseEnd,monthlyRent:r.monthlyRent,securityDeposit:r.securityDeposit,lateFee:r.lateFee,gracePeriodDays:r.gracePeriodDays,petDeposit:r.petDeposit,petRent:r.petRent}),d({title:"Lease created",description:"The lease draft has been created successfully."}),t(!1),c.reset()}catch(l){console.error("Error creating lease:",l),d({title:"Error",description:"Failed to create lease. Please try again.",variant:"destructive"})}},V=r=>{const l=new Date(c.getValues("leaseStart")),b=lt(l,r);c.setValue("leaseEnd",Y(b,"yyyy-MM-dd"))};return e.jsxs(Xe,{open:s,onOpenChange:t,children:[e.jsx(et,{asChild:!0,children:e.jsxs(F,{children:[e.jsx(at,{className:"h-4 w-4 mr-2"}),"Create Lease"]})}),e.jsxs(tt,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(st,{children:e.jsx(nt,{children:"Create New Lease"})}),e.jsx(Ae,{...c,children:e.jsxs("form",{onSubmit:c.handleSubmit(z),className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsx(y,{control:c.control,name:"propertyId",render:({field:r})=>e.jsxs(v,{children:[e.jsx(p,{children:"Property *"}),e.jsxs(k,{value:r.value,onValueChange:l=>{r.onChange(l),c.setValue("unitId",""),c.setValue("tenantId","")},children:[e.jsx(N,{children:e.jsx(P,{children:e.jsx(R,{placeholder:"Select property"})})}),e.jsx(U,{children:h?.map(l=>e.jsx(S,{value:l.id,children:l.name},l.id))})]}),e.jsx(D,{})]})}),e.jsx(y,{control:c.control,name:"unitId",render:({field:r})=>e.jsxs(v,{children:[e.jsx(p,{children:"Unit *"}),e.jsxs(k,{value:r.value,onValueChange:l=>{r.onChange(l),c.setValue("tenantId","")},disabled:!q,children:[e.jsx(N,{children:e.jsx(P,{children:e.jsx(R,{placeholder:"Select unit"})})}),e.jsx(U,{children:T?.map(l=>e.jsxs(S,{value:l.id,children:["Unit ",l.unit_number]},l.id))})]}),e.jsx(D,{})]})})]}),e.jsx(y,{control:c.control,name:"tenantId",render:({field:r})=>e.jsxs(v,{children:[e.jsx(p,{children:"Tenant *"}),e.jsxs(k,{value:r.value,onValueChange:r.onChange,disabled:!j||i,children:[e.jsx(N,{children:e.jsx(P,{children:e.jsx(R,{placeholder:i?"Loading...":n.length===0?"No tenants in this unit":"Select tenant"})})}),e.jsx(U,{children:n.map(l=>e.jsx(S,{value:l.id,children:`${l.first_name||""} ${l.last_name||""}`.trim()||l.email},l.id))})]}),e.jsx(ke,{children:"Only tenants currently assigned to this unit are shown."}),e.jsx(D,{})]})}),e.jsx(y,{control:c.control,name:"templateId",render:({field:r})=>e.jsxs(v,{children:[e.jsx(p,{children:"Lease Template"}),e.jsxs(k,{value:r.value,onValueChange:r.onChange,children:[e.jsx(N,{children:e.jsx(P,{children:e.jsx(R,{placeholder:"Select template (optional)"})})}),e.jsxs(U,{children:[e.jsx(S,{value:"",children:"No template"}),m?.map(l=>e.jsxs(S,{value:l.id,children:[l.name,l.is_default&&" (Default)"]},l.id))]})]}),e.jsx(D,{})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(p,{children:"Lease Period *"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(F,{type:"button",variant:"outline",size:"sm",onClick:()=>V(6),children:"6 Months"}),e.jsx(F,{type:"button",variant:"outline",size:"sm",onClick:()=>V(12),children:"1 Year"}),e.jsx(F,{type:"button",variant:"outline",size:"sm",onClick:()=>V(24),children:"2 Years"})]})]}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsx(y,{control:c.control,name:"leaseStart",render:({field:r})=>e.jsxs(v,{children:[e.jsx(p,{children:"Start Date"}),e.jsx(N,{children:e.jsx(C,{type:"date",...r})}),e.jsx(D,{})]})}),e.jsx(y,{control:c.control,name:"leaseEnd",render:({field:r})=>e.jsxs(v,{children:[e.jsx(p,{children:"End Date"}),e.jsx(N,{children:e.jsx(C,{type:"date",...r})}),e.jsx(D,{})]})})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(p,{children:"Financial Terms"}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsx(y,{control:c.control,name:"monthlyRent",render:({field:r})=>e.jsxs(v,{children:[e.jsx(p,{children:"Monthly Rent *"}),e.jsx(N,{children:e.jsx(C,{type:"number",placeholder:"1500",...r})}),e.jsx(D,{})]})}),e.jsx(y,{control:c.control,name:"securityDeposit",render:({field:r})=>e.jsxs(v,{children:[e.jsx(p,{children:"Security Deposit"}),e.jsx(N,{children:e.jsx(C,{type:"number",placeholder:"1500",...r})}),e.jsx(D,{})]})}),e.jsx(y,{control:c.control,name:"lateFee",render:({field:r})=>e.jsxs(v,{children:[e.jsx(p,{children:"Late Fee"}),e.jsx(N,{children:e.jsx(C,{type:"number",placeholder:"50",...r})}),e.jsx(D,{})]})}),e.jsx(y,{control:c.control,name:"gracePeriodDays",render:({field:r})=>e.jsxs(v,{children:[e.jsx(p,{children:"Grace Period (days)"}),e.jsx(N,{children:e.jsx(C,{type:"number",placeholder:"5",...r})}),e.jsx(D,{})]})}),e.jsx(y,{control:c.control,name:"petDeposit",render:({field:r})=>e.jsxs(v,{children:[e.jsx(p,{children:"Pet Deposit"}),e.jsx(N,{children:e.jsx(C,{type:"number",placeholder:"0",...r})}),e.jsx(D,{})]})}),e.jsx(y,{control:c.control,name:"petRent",render:({field:r})=>e.jsxs(v,{children:[e.jsx(p,{children:"Pet Rent (monthly)"}),e.jsx(N,{children:e.jsx(C,{type:"number",placeholder:"0",...r})}),e.jsx(D,{})]})})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(F,{type:"button",variant:"outline",onClick:()=>t(!1),children:"Cancel"}),e.jsxs(F,{type:"submit",disabled:w,children:[w&&e.jsx(rt,{className:"h-4 w-4 mr-2 animate-spin"}),"Create Lease"]})]})]})})]})]})}function js(){const s=Le(),{toast:t}=fe(),[n,a]=g.useState(""),[i,o]=g.useState(""),[d,h]=g.useState("all"),[m,x]=g.useState(!1),[w,c]=g.useState(null),[q,j]=g.useState(!1),[T,z]=g.useState(null),{data:V,isLoading:r}=It({propertyId:n||void 0,status:i||void 0}),{data:l}=Et(n||void 0),{mutate:b}=qt(),{mutate:Q}=Mt();g.useEffect(()=>{(async()=>{const{data:{session:Fe}}=await _.auth.getSession();Fe||s("/auth",{replace:!0})})()},[s]);const Z=u=>{t({title:"Coming soon",description:"Lease detail view will be available soon."})},be=u=>{t({title:"Coming soon",description:"Lease editing will be available soon."})},Ce=u=>{b({leaseId:u,status:"pending",signatureStatus:"sent"},{onSuccess:()=>{t({title:"Sent for signature",description:"The lease has been sent to the tenant for signature."})}})},Se=u=>{b({leaseId:u,status:"active"},{onSuccess:()=>{t({title:"Lease activated",description:"The lease is now active."})}})},_e=u=>{b({leaseId:u,status:"renewed"},{onSuccess:()=>{t({title:"Lease renewed",description:"The lease has been marked as renewed."})}})},Te=()=>{T&&b({leaseId:T,status:"terminated"},{onSuccess:()=>{t({title:"Lease terminated",description:"The lease has been terminated."}),j(!1),z(null)}})},Ie=()=>{w&&Q(w,{onSuccess:()=>{t({title:"Lease deleted",description:"The lease draft has been deleted."}),x(!1),c(null)}})},re=V?.filter(u=>d==="all"?!0:d==="drafts"?u.status==="draft":d==="pending"?u.status==="pending":d==="active"?["signed","active"].includes(u.status):d==="expired"?["expired","terminated"].includes(u.status):!0);return e.jsxs(Oe,{children:[e.jsxs("div",{className:"flex min-h-screen w-full bg-background",children:[e.jsx($e,{}),e.jsxs("main",{className:"flex-1 overflow-auto",children:[e.jsx(Ye,{}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Leases"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage lease agreements and renewals"})]}),e.jsx(Vt,{})]}),e.jsxs("div",{className:"grid gap-4 grid-cols-2 md:grid-cols-5",children:[e.jsxs(L,{children:[e.jsx(M,{className:"pb-2",children:e.jsx(E,{className:"text-sm font-medium text-muted-foreground",children:"Total"})}),e.jsx(A,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-2xl font-bold",children:l?.total||0})]})})]}),e.jsxs(L,{children:[e.jsx(M,{className:"pb-2",children:e.jsx(E,{className:"text-sm font-medium text-muted-foreground",children:"Drafts"})}),e.jsx(A,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"h-4 w-4 text-gray-600"}),e.jsx("span",{className:"text-2xl font-bold",children:l?.draft||0})]})})]}),e.jsxs(L,{children:[e.jsx(M,{className:"pb-2",children:e.jsx(E,{className:"text-sm font-medium text-muted-foreground",children:"Pending"})}),e.jsx(A,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(De,{className:"h-4 w-4 text-yellow-600"}),e.jsx("span",{className:"text-2xl font-bold",children:l?.pending||0})]})})]}),e.jsxs(L,{children:[e.jsx(M,{className:"pb-2",children:e.jsx(E,{className:"text-sm font-medium text-muted-foreground",children:"Active"})}),e.jsx(A,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"text-2xl font-bold",children:(l?.signed||0)+(l?.active||0)})]})})]}),e.jsxs(L,{children:[e.jsx(M,{className:"pb-2",children:e.jsx(E,{className:"text-sm font-medium text-muted-foreground",children:"Expired"})}),e.jsx(A,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(K,{className:"h-4 w-4 text-red-600"}),e.jsx("span",{className:"text-2xl font-bold",children:(l?.expired||0)+(l?.terminated||0)})]})})]})]}),e.jsx(Rt,{propertyId:n,onPropertyChange:a,status:i,onStatusChange:o}),e.jsxs(ot,{value:d,onValueChange:h,children:[e.jsxs(ct,{children:[e.jsx(O,{value:"all",children:"All"}),e.jsx(O,{value:"drafts",children:"Drafts"}),e.jsx(O,{value:"pending",children:"Pending"}),e.jsx(O,{value:"active",children:"Active"}),e.jsx(O,{value:"expired",children:"Expired"})]}),e.jsx(dt,{value:d,className:"mt-4",children:r?e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[1,2,3].map(u=>e.jsx(Re,{className:"h-64"},u))}):re?.length===0?e.jsxs(L,{className:"p-12 text-center",children:[e.jsx(J,{className:"h-12 w-12 mx-auto mb-4 text-muted-foreground opacity-50"}),e.jsx("h3",{className:"text-lg font-medium",children:"No leases found"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:d==="all"?"Create your first lease to get started":`No leases with ${d} status`})]}):e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:re?.map(u=>e.jsx(kt,{lease:u,onView:()=>Z(u.id),onEdit:()=>be(u.id),onSendForSignature:()=>Ce(u.id),onActivate:()=>Se(u.id),onTerminate:()=>{z(u.id),j(!0)},onRenew:()=>_e(u.id),onDelete:()=>{c(u.id),x(!0)}},u.id))})})]})]})]})]}),e.jsx(le,{open:m,onOpenChange:x,children:e.jsxs(oe,{children:[e.jsxs(ce,{children:[e.jsx(de,{children:"Delete Lease Draft"}),e.jsx(ue,{children:"Are you sure you want to delete this lease draft? This action cannot be undone."})]}),e.jsxs(me,{children:[e.jsx(xe,{children:"Cancel"}),e.jsx(he,{onClick:Ie,className:"bg-red-600 hover:bg-red-700",children:"Delete"})]})]})}),e.jsx(le,{open:q,onOpenChange:j,children:e.jsxs(oe,{children:[e.jsxs(ce,{children:[e.jsx(de,{children:"Terminate Lease"}),e.jsx(ue,{children:"Are you sure you want to terminate this lease? This will end the lease agreement and may have legal implications. This action cannot be undone."})]}),e.jsxs(me,{children:[e.jsx(xe,{children:"Cancel"}),e.jsx(he,{onClick:Te,className:"bg-red-600 hover:bg-red-700",children:"Terminate"})]})]})})]})}export{js as default};
